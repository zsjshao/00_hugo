# 5G原理及系统架构

## 5G概述

### 移动通信进入5G时代

```
                                                                        ------------------------------
                                                                        |         2020               |
                                                                        |          5G                |
                                               -------------------------------------------------------
                                               |        2010            | 垂直行业                     |
                                               |         4G             |  - uRLLC超低时延、mMTC超大连接 |
                      --------------------------------------------------------------------------------
                      |         2000           | 高速移动                 | 超高速移动                   | 
                      |          3G            |  - 350km/h             |  - 500km/h                  |
-------------------------------------------------------------------------------------------------------
|       1990          | 互联网应用               | 移动互联网               | eMBB                        |
|        2G           |  - 互联网应用开始出现      |  - Mbps级别的用户体验     |  - 百兆的用户体验             |
-------------------------------------------------------------------------------------------------------
| 以语音业务核心         | 以语音业务为主            | VoLTE                  | VoNR                        |
|  - 移动电话业务广泛应用 |  - 移动电话业务仍然应用广泛 |  - 基于IMS的全IP的语音业务 |  - 基于VoIP的语音业务的持续发展 |
-------------------------------------------------------------------------------------------------------
| 提供低速数据业务       | 数据业务开始发展           | 数据业务占绝对主导         | 移动数据业务进一步提速         |
|  - 100kbps速率       |  - 几十Mbps速率          |  - 几百Mbps速率          |  - 10Gpbs+速率              |
-------------------------------------------------------------------------------------------------------
```

### 3GPP标准进展

```
2015   |     2016     |  2017       2018      2019  |     2020        |
ITU    |  IMT-2020需求 |    IMT-2020提案             | IMT-2020技术规范  |
3GPP   |  R14 5G研究	 |  R15 第一阶段     R16 第二阶段          | 5G演进  |
                           NSA（2017.6)  SA(2018.6)
```

R15、R16

```
          R15(eMBB商用)                |               R16(完整业务) 
构筑NR技术框架        网络架构Ready       |      持续提示NR竞争力       开创行业数字化
- 新波形             - 上下行解耦        |      - 新多址              - uRLLC增强
- Numerology        - CU-DU切分        |      - eMBB Sub6GHZ增强   - mMTC
- 帧结构             - NSA/SA          |      - 接入回转一体化       - D2D
- 调制编码           行业应用基础设计      |                          - V2X
- Massive MIMO      - uRLLC           |                          - 非授权频谱接入
```

### 5G三大应用场景

```
            GB/s移动通信                   智能家居                   工业自动化

3D/超高清视频                  VR/AR                        智能交通                  自动驾驶
            -------------             -------------            ----------------
           | 增强移动宽带 |             | 海量机器通信 |           | 超高可靠低时延通信|
           |    eMBB    |             |    mMTC   |            |    uRLLC     |
           -------------              -----------             ---------------  高可靠应用
    高清语音              云游戏      M2M           智慧城市      移动医疗
              
              云办公

         1000倍网络容量提升             每平方公里1000K连接数             1ms时延
        10-100倍用户速率提示             10倍+电池寿命延长            99.999%可靠性
```

## 5G系统架构

### 5G系统架构

5GC（5G核心网）

- AMF（Acess and Mobility Management Function，接入与移动管理功能）
- SMF（Session Management Function，会话管理功能）
- UPF（User Plane Function 用户平面功能）主要功能是数据分组的路由转发

NG-RAN（5G接入网）

- gNB（NR系统基站）
- ng-eNB（可接入5G核心网的LTE演进基站）

```
   AMF/UPF              AMF/UPF       5GC
    / |   \           /   | \
NG /  | N   \     N /   N |   \ NG
  /   | G     \ G /     G |    \
gNB -----------Xn------------ gNB     NG-RAN
  \   |       /    \ N    |    /
Xn \  |     /        \ G  |   / Xn
    \ |   /            \  | /
   ng-eNB ------Xn------ ng-eNB
               
```

### 无线接入网

#### 4G基站组成

BBU+RRU+天馈系统

```
                    |
             |天| -----
             |线||     |
               / |     |
           馈 / |       |
          线 / |         |
            /  |         |
           _   |         |
          |R| |           |
          |R|-|           |
          |U| |           |
          /- |             |
         /   |             |
        /   |               |
    光  /    |               |
   纤  /    |                 |
     /     |                 |
    /      |                 |
   /       |                 |
  /        |                 |
[ BBU ]    |                 |
-----------------------------------------
                 4G基站

BBU-----光纤 ---RRU-----馈线-----天线
```

BBU主要负责基带信号处理和控制基站

RRU主要负责射频处理，调制和放大信号等；

天线主要负责线缆上导行波和空气中空间波之间的转换，实现发射和接收信号；

馈线主要用于连接RRU和天线

#### 5G基站组成

BBU+AAU

```
                     |
             |A|   -----
             |A|--|     |
            /|U|  |     |
           |     |       |
           |    |         |
           |    |         |
           |    |         |
           |   |           |
           |   |           |
           |   |           |
          /   |             |
         /    |             |
        /    |               |
    光  /     |               |
   纤  /     |                 |
     /      |                  |
    /       |                  |
   /        |                  |
  /         |                  |
[ BBU ]     |                  |
-----------------------------------------
                   5G基站

BBU-----光纤 ---AAU
```

BBU主要负责基带信号处理和控制基站

AAU集成了天线和RRU的功能

### 核心网

#### 4G架构

架构设计以网元为单位

移动性功能分离，但会话控制功能分散在MME、S/P-GW等网元

集中的出口网关

```
              _ _ _ _
    _ _ _    |  PCRF |
   | HSS |    - - - -
    - - -          \Gx _ _ _ _ _   
      |              \|   PGW    |----
      |               |----------|    | S5
  S6a |             / |   SGW    |----
      |           /    - - - - - 
      |         /          |
   _ _ _ _    / S11        |
  |  MME  | /              |
   - - - -  \              | S1-U
   |_ _ _|    \ S1-MME     |
     S10        \          |  
                  \    _ _ _ _ _ 
                    \ |  eNodeB  |
                       - - - - - 
```

#### 5G架构

架构设计以网络功能为单位，不再严格区分网元

基于服务化架构（SBA）的设计思路，NF进一步拆分为服务

分布式的用户功能UPF

引入网络切片

```
 -----------------------------------------
|   _ _ _     _ _ _     _ _ _     _ _ _   |    _ _ _
|  | NSSF |  | UDM |   | NEF |   | NRF |  |   |  AF |
|   - - -     - - -     - - -     - - -   |    - - -
|     |         |         |         |     |      |
|     Nnssf    Nudm     Nnef        Nnrf  |      Naf
|     |         |         |         |     |      |
_______________________________________________________ SBI
|    |         |         |         |      |
|    Nausf     Namf      Nsmf      Npcf   |
|    |         |         |         |      |
|  - - -     - - -     - - -     - - -    |
| | AUSF |  | AMF |   | SMF |   | PCF |   |
|  - - -     - - -     - - -     - - -    |
 ------------/--|---------\------------------
         N1/ N2 |          \N4
         /      |           \
    - - -      - - -   N3   - - -   N6   - - -
   |  UE |----| RAN |----- | UPF |------| DN  |
    - - -      - - -        - - -        - - -
```

#### 5G网络功能NF和4G网元NE类比

| 5G网络功能 | 功能简介                                                     | 4G中类似的网元                    |
| ---------- | ------------------------------------------------------------ | --------------------------------- |
| AMF        | 接入管理功能，注册管理/连接管理/可达性管理/移动管理/访问身份验证，授权，短消息等。终端和无线的核心网控制面接入点 | MME中的接入管理功能               |
| AUSF       | 认证服务器功能，实现3GPP和非3GPP的接入认证                   | MME中鉴权部分+EPC AAA             |
| UDM        | 统一数据管理功能，3GPP AKA认证/用户识别/访问授权/注册/移动/订阅/短信管理等 | HSS+SPR                           |
| PCF        | 策略控制功能，统一的政策框架，提供控制平面功能的策略规则     | PCRF                              |
| SMF        | 会话管理功能，隧道维护，IP地址分配和管理，UP功能选择，策略实施和QoS中的控制部分，计费数据采集，漫游功能等 | MME+SGW+PGW中会话管理等控制面功能 |
| UPF        | 用户面功能，分组路由转发，策略实施，流量报告，QoS处理        | SGW-U+PGW-U                       |
| NRF        | NF库功能，服务发现，维护可用的NF实例的信息以及支持的服务     | 无                                |
| NEF        | 网络开放功能，开放各网络功能的能力，内外部信息的转换         | SCEF中的能力开发部分              |
| NSSF       | 网络切片选择功能，选择为UE服务的一组网络切片实例             | 无                                |

### 5G NR组网方式

NSA信令锚点在LTE基站 ，SA信令锚点在NR基站

![5G NR组网方式](H:\BaiduSyncdisk\data\images\5G\5G NR组网方式.png)

```
               NSA                                       SA
优势：  按需投资，快速建网，投资回报更快                   对4G LTE网络无影响
       NSA标准冻结早，产业更成熟，业务连续性更好           建网一步到位，无需多次改造
                                                    支持5G各种新业务
                                                    支持网络切片
劣势：  5G建设和4G LTE强绑定                           标准冻结晚于NSA
       NSA到SA的过程需要多次升级改造                    终端进展稍落后于NSA
       无法引入5G新业务                               需要5G NR成片连续覆盖，初期投资成本高
       不支持网络切片
       二次改造至SA目标网总投资成本高
```

## 5G通信技术

### 全球频谱分配情况

0-100GHz

Sub6G（以3.5GHz为主）                        FR1（410-7125MHz）

mmWave（以28/39/60/73GHz为主）   FR2（24250-52600MHz）

| 频段类型 | 频段优势                             | 频段劣势                                   | 部署策略                                                     |
| -------- | ------------------------------------ | ------------------------------------------ | ------------------------------------------------------------ |
| Sub3G    | 频段低，覆盖性能好，小区带宽受限     | 可用频率资源有限大部分被当前系统占用       | 初期不建议部署，后续可以通过refarming和cloudair技术进行部署，作为5G的广覆盖层 |
| C-Band   | NR新增频段，频谱资源丰富，小区带宽大 | 上行链路覆盖较差，上下行不平衡问题比较明显 | 5G初期部署主要频段，最大可部署100Mz带宽。上下行不平衡问题可以通过上下行解耦特性来解决 |
| 毫米波   | NR新增频段，小区带宽最大             | 覆盖能力差，对射频器件性能要求高           | 初期部署不作为主要选择，主要作为热点eMBB容量补充，WTTx以及D2D等特殊场景 |

### 国内5G频谱分配情况

中国移动：2.6GHz（2515MHz----2675MHz）+4.9GHz（4800MHz---4900MHz）

中国联通：3.5GHz（3500MHz---3600MHz）

中国电信：3.5GHz（3400MHz---3500MHz）

CCN广电网络：4.9GHz（4900MHz---4960MHz）+700MHz

室内频段：3.3GHz（3300MHz---3400MHz）

### 5G带宽

载波：一段空中的电磁波，承载用户信息（语音和数据业务），基站和手机之间通过这段载波完成相互通信

载波带宽：指的是频段上的一段频谱，是在一个基站小区上分配的带宽，覆盖范围是一个扇区

- FR1，即Sub 6G小区最大小区带宽100M

- FR2，即毫米波最大小区带宽400M

- 表现形式：用RB的个数来表示，如SCS30KHz，分配100MHz，一般表示成载波带宽是273个RB

FR1频段

| SCS（KHz） | 5MHz | 10MHz | 15MHz | 20MHz | 25MHz | 30MHz | 40MHz | 50MHz | 60MHz | 80MHz | 100MHz |
| ---------- | ---- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ------ |
|            | NRB  | NRB   | NRB   | NRB   | NRB   | NRB   | NRB   | NRB   | NRB   | NRB   | NRB    |
| 15         | 25   | 52    | 79    | 106   | 133   | 160   | 216   | 270   | N/A   | N/A   | N/A    |
| 30         | 11   | 24    | 38    | 51    | 65    | 78    | 106   | 133   | 162   | 217   | 273    |
| 60         | N/A  | 11    | 18    | 24    | 31    | 38    | 51    | 65    | 79    | 107   | 135    |

FR2频段

| SCS（KHz） | 50MHz | 100MHz | 200MHz | 400MHz |
| ---------- | ----- | ------ | ------ | ------ |
| 60         | 66    | 132    | 264    | N/A    |
| 120        | 32    | 66     | 132    | 264    |

子载波：在频域位置上有连续正交的不同子载波，可承载用户信息

子载波间隔：又称SCS，Subcarrier spacing，两个波峰之间的间隔

- FR1频段子载波间隔有15KHz、30KHz、60KHz
- FR2频段子载波间隔有60KHz、120KHz

### 全双工

TDD：时分双工，不同时隙传输上下行数据

- 优点：节省频谱

- 缺点：自干扰较大

FDD：频分双工，不同频段传输上下行数据

- 优点：干扰小，易于部署
- 缺点：上行频段利用率低

全双工技术：同时同频

是指设备的发射机和接收机占用相同的频率资源同时进行工作，使得通信两端在上、下行可以在相同时间使用相同的频率，突破了现有的频分双工（FDD）和时分双工（TDD）模式，这是通信节点实现双向通信的关键之一，也是5G所需的高吞吐量和低延迟的关键技术。

### 多址技术

FDMA、OFDMA

FDMA：频分多址，不同用户占用不同频率

- 制式：GSM、WCDMA

OFDMA：正交频分多址，不同用户占用不同频率，并且子载波正交重叠

- 优点：提供频谱使用效率
- 制式：LTE

F-OFDM：Filtered-Orthogonal Frequency Division Multiplexing

- F-OFDM能为不同业务提供不同的子载波带宽和CP配置，以满足不同业务的时频资源需求
- 制式：5G

## NR空口协议栈

### 5G新空口协议栈

空中接口：终端和接入网之间的接口，也称为Uu接口

手机和基站之间的通信需要遵循空口协议栈来实现信息的交互。

```
          NR
      5G无线接入网
  Uu /
   / 
手机

手机和基站之间的通信数据有两种类型：
信令面：传控制信息
用户面：传用户数据信息
```

5G控制面协议栈与4G一样，完成空口信令连接的管理、空口安全、承载管理和移动性管理等功能

```
UE           gNB       AMF               |                  UE        gNB
   NAS                   NAS             |                   SDAP      SDAP
   RRC        RRC        L3              |                   PDCP      PDCP
   PDCP       PDCP                       |                   RLC       RLC
   RLC        RLC        L2              |                   MAC       MAC
   MAC        MAC                        |                   PHY       PHY
   PHY        PHY        L1              |

          控制面协议栈                                          用户面协议栈
```

层三（L3）：空中接口服务的使用者，即RRC信令及用户面数据

层二（L2）：对不同的层三数据进行区分表示，并提供不同的服务

层一（L1）：物理层为高层的数据提供无线资源及物理层的处理

与4G相比，5G用户面协议栈增加新的协议层SDAP，能完成QoS映射功能，提供精细的业务差异化保障。

#### 三类信道

```
 RLC
------逻辑信道
 MAC
------传输信道
 PHY
------物理信道

层和层之间通过信道进行传输，分三类信道：有逻辑信道、传输信道和物理信道
打个比方，写信给朋友
  逻辑信道=信的内容
  传输信道=信的邮寄方式（平信、挂号信、航空快件等）
  物理信道=写上地址，贴好邮票后的信件
```

逻辑信道:

存在于MAC层和RLC层之间。根据消息的类型定义每个逻辑信道类型。一般分为两种类型:控制信道和业务信道。

控制信道包括:

- BCCH(Broadcast Control Channel)广播控制信道，为系统广播信息传输使用的下行信道;
- PCCH(Paging Control Channel)寻呼控制信道，为传输寻呼信息、系统信息改变通知消息,以及指示是否有正在广播的公共告警系统信息的下行信道
- CCCH(Common Control Channel)通用控制信道，用于当终端和网络之间没有RRC时,传输终端和网络之间的控制信息
- DCCH(Dedicated Control Channel)专用控制信道，为点对点的双向信道,用于终端侧和网络侧存在RRC时的专用控制信息的传输

业务信道包括:

- DTCH(Dedicated Traffic Channel)专用数据信道,，只有一种且只用于传输用户平面的信息，为针对单个用户的点到点的业务信道,可以是单向的也可以是双向的。



传输信道:

存在于MAC层和物理层PHY之间，根据消息类型和空口上的数据传输方法进行定义。具体来说,就是信号的信道编码、选择的交织方式(交织周期、块内块间交织方式等)、CRC冗余校验的选择以及块的分段等过程的不同,而定义了不同类别的传输信道。

下行传输信道分成如下类型:

- BCH(Broadcast Channel)广播信道
- DL-SCH(Downlink Shared Channel)下行共享信道
- PCH(Paging Channel)寻呼信道

上行传输信道分成如下类型:

- UL-SCH(Uplink Shared Channel)上行共享信道
- RACH(Random Access Channel)随机接入信道



物理信道

就是在特定的频域与时域乃至于码域上采用特定的调制编码等方式发送数据的通道,物理信道就是空中接口的承载媒体,根据它所承载的上层信息的不同定义了不同的物理信道。

下行物理信道分成如下类型:

- PBCH(Physical Broadcast Channel) 物理广播信道，用于系统消息MIB的广播
- PDCCH(Physical Downlink Control Channel)物理下行控制信道，承载调度及传输格式，HARQ信息等
- PDSCH (Physical Downlink Shared Channel)!物理下行共享信道，用于承载用户专用数据

上行物理信道分成如下类型:

- PUCCH(Physical Uplink Control Channel)物理上行控制信道，承载ACK/NACK(确认/非确认),SR(调度请求)，CSl-Report(PMl:Precoding Matrix Indicator预编码矩阵指示，CQl:Channel Quality Indicator信道质量指示)
- PUSCH(Physical Uplink Shared Channel) 物理上行共享信道，承载用户专用数据
- PRACH (Physical Random Acess Channel)物理随机接入信道，承载随机接入前导



上下行信道及映射关系

```
RLC                                                 |          RLC
   BCCH  PCCH  CCCH DCCH DTCH 下行逻辑信道            |                       CCCH DCCH DTCH 上行逻辑信道
   -|-----|------|----|---|--                       |               ----------|---|-----|-
MAC |     | \    |   /   /                          |          MAC              \   \   |
   -|-----|---\--|-/---/-----                       |               --------------\---\-|-
   BCH   PCH    DL-SCH        下行传输信道            |                PACH            UL-SCH
PHY |     |      |                                  |          PHY    |                 |
   -|------\----/------------                       |               --|-----------------|--
   PBCH     PDSCH       PDCCH 下行物理信道            |                PRACH    PUCCH   PUSCH

          下行信道映射关系                                                   上行信道映射关系
```

#### 信号

下行信号:PSS、SSS、DMRS、CSI-RS、PT-RS

- PSS: Primary synchronization signal 主同步信号
- SSS: Secondary synchronization signal 辅同步信号
- DMRS: PDSCH、PDCCH、PBCH信道的解调参考信号
- CSl-RS:channel state information信道状态指示参考信号,用于RSRP、SINR和PM/CQI/RI测量
- SSB-RS:用于RSRP、SINR测量
- PT-RS:相位跟踪参考信号,用于高频场景

上行信号:SRS、DMRS、PT-RS

- DMRS:PUSCH、PUCCH的解调参考信号
- SRS:提供给基站作为下行MIMO预编码的输入:用于估计上行信道频域信息，做频率选择性调度;用于估计上行信道，做下行波束赋形
- PT-RS :相位跟踪参考信号

## 帧结构

### 时域资源

无线帧、子帧

- 无线帧frame：1个无线帧为10ms，被分为10个子帧
- 子帧：subframe：每个子帧为1ms，包含的时隙个数取决于子载波间隔

时隙、符号

- 时隙slot：调度的最小单位，每个时隙包含14个符号
- 符号symbol：一个OFDM符号包含4096个采样点，也是调制的基本单位，比如16QAM，表示的是2的4次方，指的是一个符号可以承载4个比特位数据。

























