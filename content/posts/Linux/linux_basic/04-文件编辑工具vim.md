+++
author = "zsjshao"
title = "04_文件编辑工具vim"
date = "2020-05-01"
tags = ["linux_basic","vim"]
categories = ["linux_basic"]
+++
# vim

## 1、vim编辑器

编辑器是编写或修改文本文件的重要工具之一，在各种操作系统中，编辑器都是不可缺少的部件。Linux操作系统中，系统和应用的配置大多需要通过修改配置文件来进行设置，熟练掌握Linux编辑器的用法，可以极大的提高工作效率。

 vim（vi improved）是一种强大的文件编辑器，支持复杂的文本操作。相对图形界面的gedit编辑器，vim可以很方便的在命令行中使用，可在任何Linux系统中使用。

vim是vi的高级版本，提高更多的功能，比如自动格式，语法高亮等。当系统中vim无法使用时，依然可以使用vi命令代替，用法相同。（最小化安装linux默认不安装vim）

## 2、vim打开文件

- vim [OPTION]... FILE...

```
+# 打开文件后，让光标处于第#行的行首，+默认行尾
+/PATTERN 让光标处于第一个被PATTERN匹配到的行的行首
–b file 二进制方式打开文件
–d file1 file2… 比较多个文件
-m file 只读打开文件
```

- vim -e file 或 ex file 直接进入ex模式
  - 如果该文件存在，文件被打开并显示内容
  - 如果该文件不存在，当编辑后第一次存盘时创建它

## 3、vim的3种模式

**命令模式**：打开vim编辑器，即进入命令模式（也称一般模式）。通过键盘命令，对文档进行复制、粘贴、删除、替换、移动光标、继续查找等，该模式也是编辑模式和末行模式切换的中间模式，可以通过Esc键返回到命令模式。

**编辑模式**：也称插入模式，用于对文档内容进行添加、删除、修改等操作。在编辑模式中，所有的键盘操作（除了退出编辑模式键即ESC键）都是输入或删除的操作，所以在编辑模式下没有可用的键盘命令操作。

**末行模式**：进入末行模式，光标移动到屏幕的底部，输入内置的指令，可执行相关的操作，如文件的保存、退出、定位光标、查找、替换、设置行标等。

![vim_01](http://images.zsjshao.cn/images/linux_basic/04-vim/vim_01.png)

### 3.1、进入编辑模式的命令

| 按键 | 功能                                       |
| ---- | ------------------------------------------ |
| i    | 从光标所在位置前面开始插入文本，同insert键 |
| I    | 从光标所在行的行首开始插入文本             |
| a    | 从光标所在位置后面开始插入文本             |
| A    | 从光标所在行的行尾开始插入文本             |
| o    | 从光标所在行下方新增一行插入文本           |
| O    | 从光标所在行上方新增一行插入文本           |
| s    | 删除光标所在字符并开始插入文本             |
| S    | 删除光标所在行并开始插入文本               |

### 3.2、进入末行模式的命令

| 按键 | 功能                                                         |
| :--- | ------------------------------------------------------------ |
| :    | 在后面接要执行的命令（如：x表示保存并退出）                  |
| /    | 在后面接要搜索的字符串，从光标位置开始向下搜索，按n重复前一个搜索动作，按N反向重复前一个搜索动作 |
| ?    | 在后面接要搜索的字符串，从光标位置开始向上搜索，按n重复前一个搜索动作，按N反向重复前一个搜索动作 |

不能从编辑模式直接进入末行模式，也不能从末行模式直接进入编辑模式，二者之间的转换必须先按Esc键退出到命令模式，然后再通过相关的命令按键切换。

### 3.3、退出vim编辑器

在命令模式使用ZZ保存退出，ZQ不保存退出。

在末行模式退出。在命令模式下，按“：”键进入末行模式，在末行模式下输入相关的命令

| 命令  | 功能                                                       |
| ----- | ---------------------------------------------------------- |
| q     | 没有对文档做过修改，退出                                   |
| q!    | 对文档做过修改，强制不保存退出                             |
| wq或x | 保存退出；可以添加！表示强制保存退出                       |
| ZZ    | 若文档没有修改，则不保存退出；若文档已经修改，则保存后退出 |
| ZQ    | 强制不保存退出                                             |

## 4、vim命令模式下的常用操作

在vim编辑器命令模式下，有着大量方便快捷的键盘命令，用来控制光标、操作文本。

使用vim的键盘命令，可以使用户的双手不离开主键盘区域，不使用鼠标，实现光标移动、复制、粘贴、删除等操作，熟练使用，将极大地提高工作效率。

### 4.1、光标移动

| 命令（n表数字） | 功能                                                |
| ------------- | -------------------------------------------------- |
| h/j/k/l       | 光标向左/下/上/右移动一个字符                          |
| nj            | 向下移动n行（可以是nh/nk/nl）                         |
| w             | 将光标移到下一单词的开头（W包含标点符号）                 |
| e             | 将光标移到下一单词的结尾（E包含标点符号）                 |
| b             | 将光标移到上一单词的开头（B包含标点符号）                 |
| Ctrl+f/b/d/u  | 屏幕向下/上/移动一页（半页）                            |
| n<Space 键>   | 光标向后移动n个字符                                    |
| n<Enter 键>   | 光标向下移动n行                                       |
| H/M/L         | 光标移动到屏幕上方/中央/下方                            |
| +/-           | 光标移动到非空格符的下/上一行                           |
| 0或者^         | 光标移动到行首，0是绝对行首                            |
| \$或者g_       | 光标移动到行尾，\$是绝对行尾                           |
| gg            | 光标移动到文件第一行                                  |
| G             | 光标移动到文件最后一行                                |
| nG            | 光标移动到文件的第n行                                 |
| (             | 将光标移到当前或上一句的开头                           |
| )             | 将光标移到下一句子的开头                              |
| {             | 将光标移到当前或上一段落的开头                         |
| }             | 将光标移到下一段落的开头                              |
| `%`           | 匹配括号移动，包括 `(`, `{`, `[`，需要先将光标移到括号上 |
| `*` 和 `#`    | 移动光标到下一个（或上一个）匹配单词（\*是下一个，#是上一个）|
| fs，Fs        | 到当前行下一个为s的字符处，。F相反，可与操作符一起，如dfs   |
| ts，Ts        | 到当前行s字符前的第一个字符。。T相反，可与操作符一起，如dts  |

### 4.2、删除、复制与粘贴

| 命令    | 功能                               |
| ------- | ---------------------------------- |
| x/X/nx  | 向后/前删除一（n）个字符           |
| dd/ndd  | 删除光标所在的行/向下删除n行       |
| d1G/dgg | 删除光标位置到第一行的所有数据     |
| dG      | 删除光标位置到最后一行的所有数据   |
| d0/d$   | 删除光标位置到该行行首/尾          |
| cw/ncw  | 更改光标位置的一（n）个字符串      |
| cc/C    | 删除光标所在处的整行而后转换为输入 |
| yy/nyy  | 复制光标所在一（向下n）行          |
| y1G/ygg | 复制光标位置到第一行所有行         |
| yG      | 复制光标位置到最后一行数据         |
| y0/y$   | 复制光标位置到该行行首/尾          |
| yw/nyw  | 复制光标位置一（n）个字符串        |
| p/P     | 粘贴到光标位置下/上一行            |

### 4.3、替换

| 命令 | 功能                                |
| ---- | ----------------------------------- |
| r    | 仅替换一次光标所在的字符            |
| R    | 一直替换光标所在的字符，直到按Esc键 |

### 4.4、其他

| 命令                                     | 功能                                                         |
| --------------------- | ------------------------------------ |
| u                     | 撤销前一个操作                         |
| U                     | 撤销一行内的所有改动                    |
| gU                    | 撤销一行内的所有改动                    |
| gu                   | 变小写                |
| Ctrl+r                | 重做上一个操作                         |
| \~                    | 转换大小写                            |
| J                     | 合并光标所在行与下一行                   |
| \.                    | 重复前一条命令                          |
| N\<command\>          | 重复某个命令N次                         |
| \<action\>a\<object\><br />\<action\>i\<object\> | action可以是任何的命令，如 `d` (删除), `y` (拷贝), `c` (删除并进入插入模式)。<br />object 可能是： `w` 一个单词， `W` 一个以空格为分隔的单词， `s` 一个句字， `p` 一个段落。也可以是一个特别的字符：`"、` `'、` `)、` `}、` `]。` |

## 5、vim末行模式下的常用操作

在vim末行模式下，除了最常用的保存、提出等命令外，有更多的命令组合用于完成复制的文本操作。

### 5.1、内容定界

| 字符           | 功能                              |
| ------------- | ----------------------------------- |
| #             | 第#行                                |
| .             | 当前行                               |
| $             | 最后一行                             |
| %/1,$         | 全文                                 |
| /pat1/,/pat2/ | 从第一次被pat1模式匹配的行开始，到第一次被pat2匹配的行结束 |

### 5.2、搜索替换

格式：s/要查找的内容/替换为的内容/修饰符

可以使用“**&**”引用前面查找时查找到的整个内容

| 命令                 | 功能                                                         |
| -------------------- | ------------------------------------------------------------ |
| n1,n2s/word1/word2/g | 将从n1行到n2行之间的word1替换为word2，如无g则只替换第一个匹配 |
| 1,$s/word1/word2/gc  | 将从第一行到最后一行之间的word1替换为word2，c表示每次替换确认 |
| %s/^/word2/g         | 在整个文件的每行行首插入word2                                |
| %s/$/word2/g         | 在整个文件的每行行尾插入word2                                |
| %s/var/char-&/g      | 在整个文件匹配到var后替换为char-var，&指代匹配的结果，可能为正则匹配的多种结果 |

搜索替换修饰符：

- i 忽略大小写
- g 全局替换，默认情况下，每一行只替换第一次出现
- gc 全局替换，每次替换前询问

### 5.3、其他

| 命令             | 功能                                      |
| ---------------- | ----------------------------------------- |
| w/w!             | 保存文件/强制保存文件                     |
| w filename       | 另存为filename                            |
| n1,n2 w filename | 将文件的第n1行到第n2行另存为filename      |
| r filename       | 读取另外的文件到正在编辑的文件            |
| ! command        | 暂时离开vim执行shell命令                  |
| r !command       | 把命令的输出插入到当前                    |
| sh               | 转到shell，输入exit返回                   |
| e!               | 将文件还原                                |
| set nu/set nonu  | 设置行号/取消行号                         |
| set autoindent   | 设置自动对齐格式（取消set  noautoindent） |
| set ruler        | 设置在屏幕底部显示光标所在的行列位置      |
| set ignorecase   | 忽略正则表达式的大小写                    |
| nohlsearch       | 取消搜索到的关键字的高亮显示              |

## 6、可视化模式

命令模式输入v/V/Ctrl+v则进入块操作：

- 移动光标选定操作块；
- 按y键复制；
- 按c键剪切；
- 按p键粘贴。

## 7、分隔窗口

可以在一个vim当前窗口中并排打开多个文件。

- -o：水平分割窗口
- -O：垂直分割窗口

在窗口间切换：Ctrl+w，ARROW（方向键）

- Ctrl+w，s：水平分割窗口
- Ctrl+w，v：垂直分割窗口
- ctrl+w,q：取消相邻窗口
- ctrl+w,o：取消全部窗口
- wqall ：退出

注意：单个文件也可以分割为多个窗口进行查看：

示例：水平分隔窗口命令，同时水平排列打开的文件file1.txt和file2.txt。

```
[root@zxlinux ~]# vim -o file1.txt file2.txt
```

## 8、多文件模式

vim可以同时打开多个文件，使用next、previous、last、first进行文件切换，使用wqall退出所有文件。

## 9、vim的寄存器

有26个命名寄存器和1个无命名寄存器，常存放不同的剪贴版内容，可以不同会话间共享

寄存器名称a，b,…,z,格式：“寄存器 放在数字和命令之间

- 如：3"tyy 表示复制3行到t寄存器中
- "tp 表示将t寄存器内容粘贴

未指定，将使用无命名寄存器

有10个数字寄存器，用0，1，…，9表示，0存放最近复制内容，1存放最近删除内容。当新的文本变更和删除时，1转存到2，2转存到3，以此类推。数字寄存器不能在不同会话间共享

- ma 将当前位置标记为a，26个字母均可做标记， mb 、 mc 等等
- 'a 跳转到a标记的位置，实用的文档内标记方法，文档中跳跃编辑时很有用
- qa 录制宏 a，a为宏的名称
- q 停止录制宏
- @a 执行宏 a
- @@ 重新执行上次执行的宏

## 10、编辑二进制文件

以二进制方式打开文件

```
vim –b binaryfile
```

扩展命令模式下，利用xxd命令转换为可读的十六进制

```
:%!xxd
```

插入模式下，编辑二进制文件

扩展命令模式下，利用xxd命令转换回二进制

```
:%!xxd -r
```

保存退出

## 11、vim文件恢复

使用vim编辑一个文件test.txt时，会在文件所在目录产生一个临时文件，文件名为.test.txt.swp，这是一个隐藏文件，我们在vim中所做的操作会暂时存放在该文件内。

如果在文件编辑过程中vim非正常关闭，那么重新打开vim test.txt时，系统会提示发现交付文件 .test.txt.swp，可能的原因是：

- 有另一个程序也在编辑同一个文件。
- 上次编辑此文件时崩溃。

这时可以按O只读打开，或R进行修复，或E直接编辑，或Q退出。手动删除.test.txt.swp后，则不会再出现该提示。

在对系统的关键性配置文件进行编辑修改时，强烈建议先做好原始文件的备份，因为vim编辑器对文件完成修改并保存后是无法恢复的。

## 12、定制vim的工作特性

配置文件：永久有效

- 全局：/etc/vimrc
- 个人：~/.vimrc

```
(1) 行号
显示：set number，简写 set nu
取消显示：set nonumber, 简写 set nonu
(2) 忽略字符的大小写
启用：set ignorecase，简写 set ic
不忽略：set noic
(3) 自动缩进
启用：set autoindent，简写 set ai
禁用：set noai
(4) 复制保留格式
启用：set paste
禁用：set nopaste
(5) 显示Tab和换行符 ^I 和$显示
启用：set list
禁用：set nolist
(6) 高亮搜索
启用：set hlsearch
禁用：set nohlsearch
(7) 语法高亮
启用：syntax on
禁用：syntax off
(8) 文件格式
启用windows格式：set fileformat=dos
启用unix格式：set fileformat=unix
简写 set ff=dos|unix
(9) 设置文本宽度
set textwidth=65 (vim only)
set wrapmargin=15
(10) 设置光标所在行的标识线
启用：set cursorline，简写 set cul
禁用：set nocursorline
(11) 设置tab键缩进4字符个数
启用：set tabstop=4，简写set ts=4
(12) 设备缩进字符以空白字符代替
启用：set expandtab，简写set et
禁用：set noet
```

## 13、获取帮助

Set 帮助

- :help option-list
- :set or :set all

vi/vim内置帮助

- :help
- :help topic
- Use :q to exit help

vimtutor