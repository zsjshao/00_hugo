+++
author = "zsjshao"
title = "02_IPv4编址及子网划分"
date = "2020-05-23"
tags = ["NA"]
categories = ["RS"]

+++

## 1、IPv4地址概述及分类

IPV4地址的作用：用于标识一个节点的网络地址

![01_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/01_ipv4.png)

### 1.1、IPv4报文结构

![02_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/02_ipv4.png)

版本：目前的IP协议版本号为4

服务类型：用于IP报文的标记，多用于QoS

生存时间：IP报文所允许通过的路由器的最大数量

协议：指出IP报文携带的数据使用的协议

源IP地址：标识IP数据报的源端设备

目的IP地址：标识IP数据报的目的地址

### 1.2、IPv4地址概述

IP地址结构：IPv4地址长度为32位，包括网络位和主机位两部分

- 网络位是为了标识这个IP地址所属的网段

- 主机位是为了标识这个IP地址在网段中具体的节点

![03_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/03_ipv4.png)

为了方便书写和表达，我们将IPv4地址分为4段，称为“点分十进制”

每段从0开始到255结束，最小的IP是0.0.0.0，最大的IP是255.255.255.255

![04_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/04_ipv4.png)

IP地址举例：172.16.122.204

![05_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/05_ipv4.png)

### 1.3、IPv4地址分类

早期的网络中，IP地址没有掩码的概念

为了方便划分网络大小，根据网络大小的不同，按照“有类”的方式将网络划分为A、B、C、D、E五类

A、B、C类IP地址的网络位都是固定的，D、E类IP地址没有网络位与主机位

![06_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/06_ipv4.png)

#### 1.3.1、A类IP地址范围

1.0.0.0~126.255.255.255；

前8位为网络位，第一位为0，其余的7位可以分配，A类地址共分为2^7块，每一块网络号不同；

A类地址网络号全为0和网络位全为1的地址保留；

每个A类网络可以分配的主机号的数量为2^24-2=16777214（主机号全为0和全为1的两个地址保留）；

```
A类地址的使用：
  第一块地址范围：0.0.0.0~0.255.255.255（网络号=0）；
  第二块地址范围：1.0.0.0~1.255.255.255（网络号=1）；
  ……
  最后一块地址范围：127.0.0.0~127.255.255.255（网络号=127）；
```

#### 1.3.2、B类IP地址范围

128.0.0.0~191.255.255.255；

前16位为网络位，前两位为10，其余的14位可以分配，B类地址共分为2^14块；

B类网络可以分配的主机号的数量为2^16-2=65534（主机号全为0和全为1的两个地址保留）；

```
B类地址的使用：
  第一块地址范围：128.0.0.0~128.0.255.255（网络号=128.0）；
  第二块地址范围：128.1.0.0~128.1.255.255（网络号=128.1）；
  ……
  最后一块地址范围：191.255.0.0~191.255.255.255（网络号=127）；
```

#### 1.3.3、C类IP地址范围

192.0.0.0~223.255.255.255；

前24位为网络位，前三位为110，其余的21位可以分配，C类地址共分为2^21块；

C类网络可以分配的主机号的数量为2^8-2=254（主机号全为0和全为1的两个地址保留）；

```
C类地址的使用：
  第一块地址范围：192.0.0.0~192.0.0.255（网络号=192.0.0）；
  第二块地址范围：192.0.1.0~192.0.1.255（网络号=192.0.1）；
  ……
  最后一块地址范围：223.255.255.0~223.255.255.255（网络号=223.255.255）；
```

#### 1.3.4、D类IP地址范围

224.0.0.0~239.255.255.255；

D类地址不标识网络，用于组播地址；

```
D类地址的使用：
  224.0.0.1 所有主机的地址
  224.0.0.2 所有组播路由器的地址
  224.0.0.5 所有OSPF路由器
  224.0.0.6 OSPF DR/BDR
  224.0.0.9 RIPv2路由器
  224.0.0.18 VRRP协议报文地址
```

#### 1.3.5、E类IP地址范围

240.0.0.0~247.255.255.255；

E类地址暂时保留，用于科研实验；

#### 1.3.6、私有IP地址

为了节省IP地址，将IP地址分为

- 公有地址

- 私有地址

私有地址

- A类:10.0.0.0至10.255.255.255
- B类:172.16.0.0至172.31.255.255
- C类:192.168.0.0至192.168.255.255   

私有地址只能应用于企业内网

- 在企业边界通过NAT把数据的私有地址转换为公有地址

#### 1.3.7、特殊地址

本地回环地址（测试）

- 127.X.X.X

网络号：主机位全为0

- 例：192.168.1.0/24

子网广播地址：主机位全为1

- 例：192.168.1.255/24

本地广播地址

- 255.255.255.255

未知地址：网络位和主机位全为0

- 0.0.0.0

## 2、子网划分

### 2.1、子网掩码

子网掩码用来区分IP地址中的网络位和主机位

子网掩码由连续的1和0组成：1表示对应IP地址的网络位，0表示对应IP地址的主机位

IP地址和子网掩码本质均是由32位二进制数字组成

为了书写方便，使用“/数字”法表示子网掩码

![07_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/07_ipv4.png)

### 2.2、VLSM 可变长的子网掩码

VLSM：Variable Length Subnetwork Mask ，可变长的子网掩码

- 使用多个不同的子网掩码把网络划分为不同大小的子网
- 使IP地址空间得到更有效的利用

```
子网划分示例：172.16.0.0 255.255.0.0（172.16.0.0/16）
  172.16.0.0/24
  172.16.1.0/24
  ……
  
  172.16.254.0/24
    172.16.254.0/30
    172.16.254.4/30
    ……
    172.16.254.252/30
  
  172.16.255.0/24
    172.16.255.1/32
    172.16.255.2/32
    ……
    172.16.255.255/32

```

### 2.3、子网划分

改变子网掩码，把一个大的网络划分为若干个小的网络

提高IP地址的使用率

- 子网的个数：2^X (x 代表子网的位数)

- 每个子网内有效主机个数： 2^y-2(y 代表主机位数)

![08_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/08_ipv4.png)

#### 2.3.1、子网划分示例

一个C类网段：192.168.10.0/24

默认掩码 /24（255.255.255.0）

总共IP ，2的8次方=256个

掩码就像一把“刀”，将网段进行“切割”

![09_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/09_ipv4.png)

#### 2.3.2、子网划分案例 —— A类网络

子网划分举例： 10.1.1.2 255.255.255.252（/30）

![10_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/10_ipv4.png)

- 从子网掩码中可以看出，IP地址的前30位为网络位，后两位为主机位。

- 10.1.1.2 的二进制表示如下：

![11_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/11_ipv4.png)

- 最后两位有4种组合，因此这个网段中有4个IP地址，10.1.1.0-10.1.1.3，由于每个网络的第一个和最后一个IP地址不可用，因此实际可用的IP地址为10.1.1.1和10.1.1.2 。

#### 2.3.3、子网划分案例 —— B类网络

子网划分举例：172.16.0.0 255.255.0.0（/16）

- 将一个B类地址划分为多个 C类地址
- 子网划分前可用IP地址数为2^16-2=65534个，都在同一个网段
- 子网划分后172.16.0.0被划分为2^8个C类地址，每个子类地址可用IP地址数为254个

![12_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/12_ipv4.png)

#### 2.3.4、子网划分案例 —— C类网络

子网划分举例：192.168.10.213 255.255.255.192（/26）

- 192.168.10.213是一个C类地址，默认掩码为/24
- 子网数：226-24 = 22 = 4个
- 每个网络的有效主机数：232-26-2 = 26-2= 62个

![13_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/13_ipv4.png)

### 2.4、CIDR 子网聚合

CIDR（Classless Inter-Domain Routing，无类域间路由)

- 将多个“有类”的子网合并成一个，以减少路由表中的路由条目
- 不受制于A B C类地址空间，消除了自然分类地址和子网划分的界限

![14_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/14_ipv4.png)

#### 2.4.1、CIDR 子网聚合案例

路由聚合将多条路由聚合为一条，大大减少了路由器中路由的条目

![15_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/15_ipv4.png)

#### 2.4.2、路由聚合的计算方法

第一步：将地址转换为二进制格式，并将它们对齐

第二步：找到所有地址中都相同的最后一位。在它后面划一条竖线。

第三步：竖线左边的位数为子网掩码位数。

第四步：竖线右边全设为零，竖线左边保持不变，即可形成路由汇总网络地址

![16_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/16_ipv4.png)

## 3、园区网络IP地址规划

### 3.1、IP地址规划原则

IP地址规划的好坏，将会直接给网络带来影响：

- 网络路由协议算法的效率
- 网络的性能
- 网络的扩展
- 网络的管理

IP地址规划主要遵从四个原则：

- **唯一性：**一个IP网络中不能有两个主机使用相同的IP地址
- **可扩展性**：在IP地址分配时，要有一定的余量，以满足网络扩展时的需要
- **连续性**：分配的连续的IP地址要有利于管理和地址汇总，连续的IP地址易于汇总，减小路由表，提高路由效率
- **实意性**：分配IP地址时尽量使所分配的IP地址具有一定实际意义
  - 例如：使人一看到该IP地址就可以知道此IP地址分配给了哪个部门或哪个地区

### 3.2、节约IP地址的技巧

在分配IP地址时，如需要节约IP地址，注意以下几点：

- 配置Loopback地址时，使用的子网掩码为32
- 配置互联地址时，使用的子网掩码为/30
- 对各业务网关进行统一设定
  - 比如：将所有的网关统一设置成X.X.X.254

- 在完成IP地址规划之后，公司既可以配置静态IP地址，也可以使用DHCP服务器动态分配IP地址

![17_ipv4](http://images.zsjshao.cn/images/rs/02-ipv4/17_ipv4.png)

### 3.3、园区网络IP地址规划练习

某园区网络进行全新组网，网络设计阶段需要对IP地址进行规划，用户需求如下：

整套网络系统需要根据功能模块进行规划：

- 办公网络，需要进行预留
- 业务网络，需要进行预留
- 设备管理网段，使用32位的掩码
- 设备互联网段，使用30位的掩码

园区的楼宇以及终端设备数量情况如下：

- 总共3栋楼，每栋楼3层，每层10间房间
- 每间房间，大约有3台办公设备，3台业务设备

网络设备根据IP地址规划需求进行部署

