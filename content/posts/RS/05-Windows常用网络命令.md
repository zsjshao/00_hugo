+++
author = "zsjshao"
title = "05_Windows常用网络命令"
date = "2020-05-23"
tags = ["NA"]
categories = ["RS"]
+++

## 1、ICMP

### 1.1、ICMP协议

ICMP协议全称Internet控制报文协议（Internet Control Message Protocol），是网络层的一个重要协议

ICMP协议用来在网络设备间传递各种差错和控制信息

对于收集各种网络信息、诊断和排除各种网络故障具有至关重要的作用

ICMP协议有两个重要应用，在Windows系统与RGOS中经常会使用到

- ping

- tracert

![01_windows](http://images.zsjshao.cn/images/rs/05-windows/01_windows.png)

### 1.2、ICMP信息反馈

根据ICMP的反馈信息，可以分析出到达目的地址连通性的信息

根据这些信息反馈，可以初步分析网络故障的原因

| **反馈信息**                  | **信息解释**                                       |
| ----------------------------- | -------------------------------------------------- |
| ！                            | 收到1个ICMP的request  replay                       |
| U                             | 收到1个ICMP不可达信息                              |
| .                             | 表示在规定的时间内没有收到对应的request  replay    |
| Request  Timed Out            | 超时，目标主机不存在  或ICMP应答功能关闭，不予应答 |
| Destination  Host Unreachable | 网络设备没有到目标主机的路由                       |
| Unknown  host                 | 未知主机  ，有可能是DNS的问题                      |

### 1.3、ping命令应用解析

#### 1.3.1、ping命令

- 作用：基于ICMP协议，测试网络联通性

![02_windows](http://images.zsjshao.cn/images/rs/05-windows/02_windows.png)

- 默认情况下，ping操作会收到4个ICMP回包，包大小为32字节，TTL等于64。
- 操作演示：

```
C:\Users\zengs>ping www.baidu.com

正在 Ping www.a.shifen.com [163.177.151.110] 具有 32 字节的数据:
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=4ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54

163.177.151.110 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 4ms，最长 = 5ms，平均 = 4ms
```

#### 1.3.2、ping命令扩展（-t）

- 作用：长ping数据包不中断
- 说明：键入Ctrl+C可中断ICMP回包
- 操作演示：

```
C:\Users\zengs>ping www.baidu.com -t

正在 Ping www.a.shifen.com [163.177.151.110] 具有 32 字节的数据:
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=4ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=4ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=4ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54
...
```

#### 1.3.3、ping命令扩展（-n）

- 作用：指定单次ping包的发送数量
- 操作演示：

```
C:\Users\zengs>ping www.baidu.com -n 3

正在 Ping www.a.shifen.com [163.177.151.110] 具有 32 字节的数据:
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=4ms TTL=54
来自 163.177.151.110 的回复: 字节=32 时间=5ms TTL=54

163.177.151.110 的 Ping 统计信息:
    数据包: 已发送 = 3，已接收 = 3，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 4ms，最长 = 5ms，平均 = 4ms
```

#### 1.3.4、ping命令扩展（-l）

- 作用：修改ping包大小，默认为32字节。可用于测试接口MTU值设置是否合理等场景
- 操作演示：

```
C:\Users\zengs>ping www.baidu.com -l 1380

正在 Ping www.a.shifen.com [163.177.151.109] 具有 1380 字节的数据:
来自 163.177.151.109 的回复: 字节=1380 时间=5ms TTL=54
来自 163.177.151.109 的回复: 字节=1380 时间=5ms TTL=54
来自 163.177.151.109 的回复: 字节=1380 时间=5ms TTL=54
来自 163.177.151.109 的回复: 字节=1380 时间=5ms TTL=54

163.177.151.109 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 5ms，最长 = 5ms，平均 = 5ms
```

#### 1.3.5、ping命令扩展（-f）

- 作用：强制ping操作时，数据包不分片，常用于测试MTU值的设定
- 操作演示：图中表示ping的包超过MTU值，应该需要拆分，但是强制不拆分，造成发送错误

```
C:\Users\zengs>ping www.baidu.com -l 1600 -f

正在 Ping www.a.shifen.com [163.177.151.109] 具有 1600 字节的数据:
需要拆分数据包但是设置 DF。
需要拆分数据包但是设置 DF。
需要拆分数据包但是设置 DF。
需要拆分数据包但是设置 DF。

163.177.151.109 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 0，丢失 = 4 (100% 丢失)，
```

### 1.4、tracert命令应用解析

#### 1.4.1、tracert命令

- 作用：基于ICMP协议，在探测网络连通性的同时，探测到目标主机所经过的路径，显示沿路径设备的接口IP
- 原理：
  - 源主机首先发三个包，TTL=1
  - 第一台路由器收到后，TTL-1=0，丢弃并回复源主机ICMP报超时消息
  - 收到超时消息，源主机显示信息并发送下一组三个包，TTL=上一组TTL+1
  - 收到目标主机的应答后程序终止
  - *号表示探测包丢失

![03_windows](http://images.zsjshao.cn/images/rs/05-windows/03_windows.png)

- 运营商核心骨干网及大型IDC数据中心为了安全起见一般会通过相关技术做到核心路径隐藏，此时tracert并非实际路径跟踪

- 操作演示

```
C:\Users\zengs>tracert www.baidu.com

通过最多 30 个跃点跟踪
到 www.a.shifen.com [163.177.151.110] 的路由:

  1    <1 毫秒   <1 毫秒   <1 毫秒 192.168.3.1
  2    <1 毫秒   <1 毫秒   <1 毫秒 192.168.1.1
  3     3 ms     1 ms     6 ms  bogon [10.93.0.1]
  4     *        *        *     请求超时。
  5     5 ms     3 ms     2 ms  120.80.78.13
  6    11 ms     7 ms     6 ms  112.91.0.253
  7     6 ms     5 ms     5 ms  112.89.0.146
  8     4 ms     4 ms     4 ms  120.80.137.186
  9     6 ms     5 ms     6 ms  157.255.69.162
 10     *        *        *     请求超时。
 11     5 ms     5 ms     5 ms  163.177.151.110

跟踪完成。
```

## 2、ipconfig命令应用解析

### 2.1、ipconfig命令

- 作用：显示所有适配器（网卡）的基本IP配置
- 操作演示：

```
C:\Users\zengs>ipconfig

Windows IP 配置


以太网适配器 以太网 2:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

以太网适配器 以太网:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::b8e1:1be9:a15b:485%14
   IPv4 地址 . . . . . . . . . . . . : 192.168.3.103
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 192.168.3.1
```

### 2.2、ipconfig /all命令

- 作用：显示所有适配器（网卡）详细完整的IP配置
- 操作演示：

```
C:\Users\zengs>ipconfig /all

以太网适配器 以太网:

   连接特定的 DNS 后缀 . . . . . . . :
   描述. . . . . . . . . . . . . . . : Intel(R) Ethernet Connection (2) I219-V
   物理地址. . . . . . . . . . . . . : 70-8B-CD-4F-98-BC
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是
   本地链接 IPv6 地址. . . . . . . . : fe80::b8e1:1be9:a15b:485%14(首选)
   IPv4 地址 . . . . . . . . . . . . : 192.168.3.103(首选)
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   获得租约的时间  . . . . . . . . . : 2020年5月27日 0:09:52
   租约过期的时间  . . . . . . . . . : 2020年5月28日 11:39:04
   默认网关. . . . . . . . . . . . . : 192.168.3.1
   DHCP 服务器 . . . . . . . . . . . : 192.168.3.1
   DHCPv6 IAID . . . . . . . . . . . : 124816333
   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-26-37-95-82-70-8B-CD-4F-98-BC
   DNS 服务器  . . . . . . . . . . . : 192.168.3.1
   TCPIP 上的 NetBIOS  . . . . . . . : 已启用
```

### 2.3、ipconfig /flushdns命令

- 作用：查看Windows系统arp表项。
- 说明：可使用ipconfig /flushdns清除DNS缓存表
- 操作演示：

```
C:\Users\zengs>ipconfig /flushdns

Windows IP 配置

已成功刷新 DNS 解析缓存。
```

## 3、arp 命令应用解析

### 3.1、arp –a 命令

- 作用：查看Windows系统arp表项。
- 操作演示

```
C:\Users\zengs>arp -a

接口: 192.168.13.1 --- 0x6
  Internet 地址         物理地址              类型
  192.168.13.254        00-50-56-e2-f9-81     动态
  192.168.13.255        ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态

接口: 192.168.3.103 --- 0xe
  Internet 地址         物理地址              类型
  192.168.3.1           a0-41-47-a0-20-73     动态
  192.168.3.255         ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态

接口: 192.168.116.1 --- 0x10
  Internet 地址         物理地址              类型
  192.168.116.254       00-50-56-fe-72-81     动态
  192.168.116.255       ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态
```

### 3.2、arp –s 命令

- 作用：手动设置arp映射关系，此项操作需要管理员权限
- 操作演示

```
C:\Users\zengs>arp -s 192.168.3.253 11-22-33-44-55-66
ARP 项添加失败: 请求的操作需要提升。

C:\Windows\system32>arp -s 192.168.3.253 11-22-33-44-55-66
C:\Windows\system32>arp -a

接口: 192.168.13.1 --- 0x6
  Internet 地址         物理地址              类型
  192.168.13.254        00-50-56-e2-f9-81     动态
  192.168.13.255        ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态

接口: 192.168.3.103 --- 0xe
  Internet 地址         物理地址              类型
  192.168.3.1           a0-41-47-a0-20-73     动态
  192.168.3.253         11-22-33-44-55-66     静态
  192.168.3.255         ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态
```

### 3.3、arp –d命令

- 作用：清除arp缓存表，通配符*表示所有地址
- 操作演示

```
C:\Windows\system32>arp -d 192.168.3.253

C:\Windows\system32>arp -a

接口: 192.168.13.1 --- 0x6
  Internet 地址         物理地址              类型
  192.168.13.254        00-50-56-e2-f9-81     动态
  192.168.13.255        ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态

接口: 192.168.3.103 --- 0xe
  Internet 地址         物理地址              类型
  192.168.3.1           a0-41-47-a0-20-73     动态
  192.168.3.255         ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态
```

## 4、route命令应用解析

### 4.1、route print 命令

- 作用：查看Windows系统路由表
- 操作演示：    

```
C:\Windows\system32>route print
===========================================================================
接口列表
 18...00 ff 99 a4 19 83 ......Sangfor SSL VPN CS Support System VNIC
 14...70 8b cd 4f 98 bc ......Intel(R) Ethernet Connection (2) I219-V
  6...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1
 16...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8
 12...00 1a 7d da 71 13 ......Bluetooth Device (Personal Area Network)
  1...........................Software Loopback Interface 1
===========================================================================

IPv4 路由表
===========================================================================
活动路由:
         网络目标          网络掩码               网关               接口   跃点数
        0.0.0.0          0.0.0.0       192.168.3.1     192.168.3.103     25
      127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331
      127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331
127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
    192.168.3.0    255.255.255.0            在链路上     192.168.3.103    281
  192.168.3.103  255.255.255.255            在链路上     192.168.3.103    281
  192.168.3.255  255.255.255.255            在链路上     192.168.3.103    281
   192.168.13.0    255.255.255.0            在链路上      192.168.13.1    291
   192.168.13.1  255.255.255.255            在链路上      192.168.13.1    291
 192.168.13.255  255.255.255.255            在链路上      192.168.13.1    291
  192.168.116.0    255.255.255.0            在链路上     192.168.116.1    291
  192.168.116.1  255.255.255.255            在链路上     192.168.116.1    291
192.168.116.255  255.255.255.255            在链路上     192.168.116.1    291
```

### 4.2、添加/删除静态路由

route [–p] add 【目标IP地址/网段】 mask 【子网掩码】【下一跳】

- 作用：Windows添加静态路由
- 操作演示

```
C:\Windows\system32>route -p add 172.16.10.0 mask 255.255.255.0 192.168.3.1
 操作完成!
```

- route print查看

```
永久路由:
     网络地址          网络掩码          网关地址       跃点数
172.16.10.0    255.255.255.0      192.168.3.1       1
```

- route delete删除

```
C:\Windows\system32>route delete 172.16.10.0 mask 255.255.255.0
 操作完成!
```

注意：增添/删除静态路由操作需要在Windows超级管理员权限下进行。   

