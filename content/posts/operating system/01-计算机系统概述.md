+++
author = "zsjshao"
title = "01_计算机系统概述"
date = "2021-01-01"
tags = ["OS"]
categories = ["OS"]

+++

# 计算机系统概述

**知识框架**

![os](http://images.zsjshao.net/ky/os/1/01.png)

## 1、操作系统的基本概念

​    在信息化时代,软件是计算机系统的灵魂,而作为软件核心的操作系统,已与现代计算机系统密不可分、融为一体计算机系统自下而上可大致分为4部分:硬件、操作系统、应用程序和用户这里的划分与计算机组成原理中的分层不同操作系统管理各种计算机硬件,为应用程序提供基础,并充当计算机硬件与用户之间的中介。

​    操作系统(Operating System,OS)是指控制和管理整个计算机系统的硬件与件资源,合理地组织、调度计算机的工作与资源的分配,进而为用户和其他软件提供方便接口与环境的程序集合,操作系统是计算机系统中最基本的系统软件。

**大家熟悉的操作系统**

![os](http://images.zsjshao.net/ky/os/1/02.png)

**思维导图**

![os](http://images.zsjshao.net/ky/os/1/03.png)

### 1.1、操作系统的概念（定义）

一台电脑的诞生~

- Step 1：厂家组装一台裸机
- Step 2：出售前安装操作系统
- Step 3：用户安装应用程序（eg：QQ）
- Step 4：使用QQ 聊天

![os](http://images.zsjshao.net/ky/os/1/04.png)

操作系统（Operating System， OS）是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调
度计算机的工作和资源的分配；以提供给用户和其他软件方便的接口和环境；它是计算机系统中最基本的系统软件。

- 操作系统是系统资源的管理者
- 操作系统向上层提供方便易用的服务
- 操作系统是最接近硬件的一层软件

直观的例子：打开Windows 操作系统的“任务管理器”（快捷键：Ctrl+Alt+Del）

![os](http://images.zsjshao.net/ky/os/1/05.png)

### 1.2、操作系统的功能和目标

![os](http://images.zsjshao.net/ky/os/1/06.png)

1、操作系统`作为系统资源的管理者`（这些资源包括软件、硬件、文件等），需要提供什么功能？

2、操作系统`作为用户与计算机硬件之间的接口`，要为其上层的用户、应用程序提供简单易用的服务，需要实现什么功能？

3、操作系统`作为最接近硬件的层次`，需要在纯硬件的基础上实现什么功能？

#### 1.2.1、作为系统资源的管理者

![os](http://images.zsjshao.net/ky/os/1/07.png)

作为系统资源的管理者，操作系统需提供的功能

- 处理机管理（进程管理）
- 存储器管理（内存管理）
- 文件管理
- 设备管理

且要确保能达到安全、高效的目标

补充知识：执行一个程序前需要将该程序放到内存中，才能被CPU处理。

用QQ和朋友视频聊天的过程：

- Step 1：在各个文件夹中找到QQ 安装的位置（如D:/Tencent/QQ/Bin）
- Step 2：双击打开QQ.exe
- Step 3：QQ 程序正常运行
- Step 4：开始和朋友视频聊天

#### 1.2.2、作为用户和计算机硬件之间的接口

![os](http://images.zsjshao.net/ky/os/1/08.png)

- 命令接口：允许用户直接使用
- 程序接口：允许用户通过程序间接使用
- GUI：现代操作系统中最流行的图形用户接口

##### 1.2.2.1、命令接口

![os](http://images.zsjshao.net/ky/os/1/09.png)

**联机命令接口实例**（Windows系统） 联机命令接口=`交互式`命令接口

- Step 1：win键+R
- Step 2：输入cmd，按回车，打开命令解释器
- Step 3：尝试使用time 命令

![os](http://images.zsjshao.net/ky/os/1/10.png)

特点：用户说一句，系统跟着做一句



**脱机命令接口实例**（windows系统）   脱机命令接口=`批处理`命令接口

使用windows系统的搜索功能，搜索C盘中的*.bat文件，用记事本任意打开一个

![os](http://images.zsjshao.net/ky/os/1/11.png)

特点：用户说一堆，系统跟着做一堆

##### 1.2.2.2、程序接口

可以在程序中进行系统调用来使用程序接口。普通用户不能直接使用程序接口，只能通过程
序代码间接使用。

程序接口=系统调用=系统调用命令=广义命令

##### 1.2.2.3、图形接口

GUI：图形用户界面（Graphical User Interface）

- 用户可以使用形象的图形界面进行操作，而不再需要记忆复杂的命令、参数。
- 例：在Windows操作系统中，删除一个文件只需要把文件“拖拽”到回收站即可。

![os](http://images.zsjshao.net/ky/os/1/12.png)

#### 1.2.3、作为最接近硬件的层次

需要实现对硬件机器的拓展

没有任何软件支持的计算机成为裸机。在裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能更强、使用更方便的机器

通常把覆盖了软件的机器成为`扩充机器`，又称之为`虚拟机`

类比：

- 硬件：锤子、锯子、木头、钉子 ...
- 操作系统：优秀的工匠

操作系统对硬件机器的拓展：将CPU、内存、磁盘、显示器、键盘等硬件合理地组织起来，让各种硬件
能够相互协调配合，实现更多更复杂的功能

普通用户无需关心这些硬件在底层是怎么组织起来工作的，只需直接使用操作系统提供的接口即可

### 1.3、操作系统的特征

![os](http://images.zsjshao.net/ky/os/1/13.png)

#### 1.3.1、操作系统的特征--并发

并发：指两个或多个事件在**同一时间间隔内发生**。这些事件宏观上是同时发生的，但微观上是交替发生的。
常考易混概念——并行：指两个或多个事件在同一时刻同时发生。

操作系统的并发性指计算机系统中同时存在着多个运行着的程序。

一个单核处理机（CPU）同一时刻只能运行一个程序，因此操作系统会负责协调多个程序交替运行（这些程序微观上是交替执行的，但宏观上看起来就像在同时执行）

事实上，操作系统就是伴随着“多道程序技术”而出现的。因此，操作系统和程序并发是一起诞生的。

当今的计算机，一般都是多核CPU，比如4核CPU意味着同一时刻可以有4个程序并行执行，但是操作系统的并发性依然必不可少，当代人使用计算机绝对有4个以上的程序需要同时工作。

![os](http://images.zsjshao.net/ky/os/1/14.png)

#### 1.3.2、操作系统的特征--共享

共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。

![os](http://images.zsjshao.net/ky/os/1/15.png)

所谓的“同时”往往是宏观上的，而在微观上，这些进程可能是交替地对该资源进行访问的（即分时共享）

生活实例：

互斥共享方式：使用QQ和微信视频。同一时间段内摄像头只能分配给其中一个进程。

同时共享方式：使用QQ发送文件A，同时使用微信发送文件B。宏观上看，两边都在同时读取并发送文件，
说明两个进程都在访问硬盘资源，从中读取数据。微观上看，两个进程是交替着访问硬盘的。

#### 1.3.3、操作系统的特征--并发和共享的关系

并发性是指计算机系统中同时存在着多个运行着的程序。

共享性是指系统中的资源可供内存中多个并发执行的进程共同使用。

通过上述例子来看并发与共享的关系：

- 使用QQ发送文件A，同时使用微信发送文件B。
- 1.两个进程正在并发执行（并发性）
- 2.需要共享地访问磁盘资源（共享性）

如果失去并发性，则系统中只有一个程序正在运行，则共享性失去存在的意义

如果失去共享性，则QQ和微信不能同时访问硬盘资源，就无法实现同时发送文件，也就无法并发。

![os](http://images.zsjshao.net/ky/os/1/16.png)

#### 1.3.4、操作系统的特征--虚拟

虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上
对应物（后者）是用户感受到的。

用一个例子来理解

背景知识：一个程序需要放入内存并给它分配CPU才能执行

- GTA5需要4GB的运行内存，QQ 需要256MB的内存，迅雷需要256MB的内存，网易云音乐需要256MB的内存……
- 我的电脑：4GB内存
- 问题：这些程序同时运行需要的内存远大于4GB，那么为什么它们还可以在我的电脑上同时运行呢？
- 答：这是虚拟存储器技术。实际只有4GB的内存，在用户看来似乎远远大于4GB

![os](http://images.zsjshao.net/ky/os/1/17.png)

某单核CPU的计算机中，用户打开了以下软件...

![os](http://images.zsjshao.net/ky/os/1/18.png)

问题：既然一个程序需要被分配CPU才能正常执行，那么为什么单核CPU的电脑中能同时运行这么多个程序呢？

答：这是虚拟处理器技术。实际上只有一个单核CPU，在用户看来似乎有6个CPU在同时为自己访问。

![os](http://images.zsjshao.net/ky/os/1/19.png)

![os](http://images.zsjshao.net/ky/os/1/20.png)

#### 1.3.5、操作系统的特征--异步

异步是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

只有系统拥有并发性，才有可能导致异步性。

#### 1.3.6、总结

![os](http://images.zsjshao.net/ky/os/1/21.png)

重点：

- 理解并发和并行的区别
- 并发和共享互为存在条件
- 没有并发和共享，就谈不上虚拟和异步，因此并发和共享是操作系统的两个最基本的特征

### 1.4、习题

#### 1.4.1、单项选择题

**1.操作系统是一种()**

A.通用软件  B.系统软件

C.应用软件  D.软件包

**2,操作系统是对()进行管理的软件**

A.软件    B.硬件
C.计算机资源    D.应用

**3.下面()资源不是操作系统应该管理的**

A. CPU    B.内存
C.外存    D.源程序

**4.下列选项中()不是操作系统关心的问题**

A.管理计算机裸机    B.设计,提供用户程序与硬件系统的界面
C.管理计算机系统资源    D.高级程序设计语言的编译器

**5.操作系统的基本功能是()**

A.提供功能强大的网络管理工具    B.提供用户界面方使用户使用
C.提供方便的可视化编辑程序    D.控制和管理系统内的各种资源

**6.现代操作系统中最基本的两个特征是()**

A.并发和不确定    B.并发和共享
C.共享和拟    D.虚拟和不确定

**7.下列关于并发性的叙述中,正确的是()**

A.并发性是指若事件在同一时刻发生    B.并发性是指若干事件在不同时刻发生
C.并发性是指若干事件在同一时间间隔内发生    D.并发性是指若干事件在不同时间间隔内发生

**8.【2009统考真题】单处理机系统中,可并行的是(）**

Ⅰ.进程与进程  Ⅱ.处理机与设备  Ⅲ.处理机与通道  Ⅳ.设备与设备

A.Ⅰ、Ⅱ、Ⅲ    B.Ⅰ、Ⅱ、Ⅳ
C.Ⅰ、Ⅲ、Ⅳ    D.Ⅱ、Ⅲ、Ⅳ

**9.用户可以通过()两种方式来使用计算机**

A.命令接口和函数    B.命令接口和系统调用
C.命令接口和文件管理    D.设备管理方式和系统调用

**10.系统调用是由操作系统提供给用户的,它()**

A直接通过键盘交互方式使用    B.只能通过用户程序间接使用
C.是命接口中的命令    D,与系统的命令一样

**11.【2010统考真题】下列选项中,操作系统提供给应用程序的接口是()**

A,系统调用    B.中断
C.库函数    D.原语

**12.操作系统提供给编程人员的接口是()**

A.库函数    B.高级语言
C.系统调用    D.子程序

**13.系统调用的目的是()**

A.请求系统服务    B.中止统服务
C.申请系统资源    D.释放系统资源

**14.为了方使用户直接或接地控制自己的作业操作系统向用户提供了命令接口，该接口又可进一步分为()**

A.联机用户接口和脱机用户接口    B.程序接口和图形接口
C.联机用户接口和程序接口    D.机用户接口和图形接口

**15.用户在程序中试图读某文件的第100个逻辑块使用操作系统提供的()接口**

A.系统调用    B.键盘命今
C.原语    D.图形用户接口

**16.操作系统与用户通信接口通常不包括()**

 A. shell    B.命令解释器
C.广义指令    D.缓存管理指令

**17.下列选项中,不属于多道程序设计的基本特征是()**

A.制约性    B.同断性
C.顺序性    D.共享性

**18.以下关于操作系统的叙述中,错误的是()**

A.操作系统是管理资源的程序    B.操作系统是管理用户程序执行的程序
C.操作系统是能使系统资源提高效率的程序    D.操作系统是用来编程的程序

**19.【2013统考真题】计算机开机后,操作系统最终被加载到()**

 A. BIOS     B. ROM
 C. EPROM     D.RAM

答案：

BCDDD BCDBB

ACAAA DCDD

#### 1.4.2、综合应用题

1.说明库函数与系统调用的区别和联系

库函数是语言或应用程序的一部分,可以运行在用户空间中。而系统调用是操作系统的一部分,是内核为用户提供的程序接口,运行在内核空间中,而且许多库函数都会使用系统调用来实现功能。未使用系统调用的库函数,其执行效率通常要比系统调用的高。因为使用系统调用时,需要上下文的切换及状态的转换(由用户态转向核心态)

## 2、操作系统的发展与分类

![os](http://images.zsjshao.net/ky/os/1/22.png)

学习提示：要重点关注和理解各类操作系统主要想解决的是什么问题，各自的优缺点。

### 2.1、手工操作阶段

![os](http://images.zsjshao.net/ky/os/1/23.png)

主要缺点：用户独占全机、人机速度矛盾导致资源利用率极低

### 2.2、批处理阶段--单道批处理系统

引入脱机输入/输出技术（用外围机+磁带完成），并由监督程序（操作系统的雏形）负责控制作业的输入、输出

![os](http://images.zsjshao.net/ky/os/1/24.png)

主要优点：缓解了一定程度的人机速度矛盾，资源利用率有所提升。

主要缺点：内存中仅能有一道程序运行，只有该程序运行结束之后才能调入下一道程序。CPU有大量的时间是在空闲等待I/O完成。资源利用率依然很低。

### 2.3、批处理阶段--多道批处理系统

![os](http://images.zsjshao.net/ky/os/1/25.png)

主要优点：多道程序并发执行，共享计算机资源。资源利用率大幅提升，CPU和其他资源更能保持“忙碌”状态，系统吞吐量增大。

主要缺点：用户响应时间长，没有人机交互功能（用户提交自己的作业之后就只能等待计算机处理完成，中间不能控制自己的作业执行。eg：无法调试程序/无法在程序运行过程中输入一些参数）

### 2.4、分时操作系统

![os](http://images.zsjshao.net/ky/os/1/26.png)

分时操作系统：计算机以时间片为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。

主要优点：用户请求可以被即时响应，解决了人机交互问题。允许多个用户同时使用一台计算机，并且用
户对计算机的操作相互独立，感受不到别人的存在。

主要缺点：不能优先处理一些紧急任务。操作系统对各个用户/作业都是完全公平的，循环地为每个用户/
作业服务一个时间片，不区分任务的紧急性。

### 2.5、实时操作系统

实时操作系统：

主要优点：能够优先响应一些紧急任务，某些紧急任务不需时间片排队。

在实时操作系统的控制下，计算机系统接收到外部信号后及时进行处理，并且要在严格的时限内处理完事件。实时操作系统的主要特点是及时性和可靠性。

![os](http://images.zsjshao.net/ky/os/1/27.png)

### 2.6、其他几种操作系统

网络操作系统：是伴随着计算机网络的发展而诞生的，能把网络中各个计算机有机地结合起来，实现数据传送等功能，实现网络中各种资源的共享（如文件共享）和各台计算机之间的通信。（如：Windows NT 就是一种典型的网络操作系统，网站服务器就可以使用）

分布式操作系统：主要特点是分布性和并行性。系统中的各台计算机地位相同，任何工作都可以分布在这些计算机上，由它们并行、协同完成这个任务。

个人计算机操作系统：如Windows XP、MacOS，方便个人使用。

### 2.7、总结

![os](http://images.zsjshao.net/ky/os/1/28.png)

### 2.8、习题

#### 2.8.1、单项选择题

**1.提高单机资源利用率的关键技术是(**

A.脱机技术    B.虚拟技术
C.交换技术    D.多道程序设计技术

**2.批处理系统的主要缺点是**

A.系统吞吐量小    B.CPU利用率不高
C.资源利用率低    D.无交互能力

**3.下列选项中,不属于多道程序设计的基本特征的是()**

A.制约性    B.间断性
C.顺序性    D.共享性

**4.操作系统的基本类型主要有()**

A.批处理操作系统、分时操作系统和多任务系统    B.批处理操作系统、分时操作系统和实时操作系统
C.单用户系统、多用户系统和批处理操作系统    D.实时操作系统、分时操作系统和多用户系统

**5.【2016统考真题】下列关于批处理系统的叙述中,正确的是()**

Ⅰ.批处理系统允许多个用户与计算机直接交互

Ⅱ.批处理系统分为单道批处理系统和多道批处理系统

Ⅲ.中断新技术使得多道批处理系统和1O设备可与CPU并行工作

A.仅Ⅱ、Ⅲ    B.仅Ⅱ
C.仅Ⅰ、Ⅱ    D.仅Ⅰ、Ⅲ

**6.【2017统考真题】与单道程序系统相比,多道程序系统的优点是()**

Ⅰ.CPU利用率高    Ⅱ.系统开销小

Ⅲ.系统吞吐量大   Ⅳ.I/O设备利用率高

A.仅Ⅰ.Ⅲ    B.仅Ⅰ、Ⅳ
C.仅Ⅱ、Ⅲ    D.仅Ⅰ、Ⅲ、Ⅳ

**7.实时操作系统必须在()内处理来自外部的事件**

A.一个机器周期    B.被控制对象规定时间
C.周转时间    D.时间片

**8.实时系统的进程调度,通常采用()算法,**

A.先来先服务    B.时间片轮转
C.枪占式的优先级高者优先    D.高响应比优先

**9.()不是设计实时操作系统的主要追求目标**

A.安全可靠    B.资源利用率
C.及时响应    D.快速处理

**10.下列()应用工作最好采用实时操作系统平台**

Ⅰ.航空订票  Ⅱ.办公自动化  Ⅲ.机床控制

Ⅳ. AutoCAD Ⅴ.工资管理系统 Ⅵ.股票交易系统

A.Ⅰ、Ⅱ和Ⅲ    B.Ⅰ、Ⅲ和Ⅳ
C.Ⅰ、V和Ⅳ    D.Ⅰ、Ⅲ和Ⅵ

**11.分时系统的一个重要性能是系统的响应时间,对操作系统的()因素进行改进有利于改善系统的响应时间**

A,加大时间片    B.采用静态页式管理
C.优先级+非抢占式调度算法    D.代码可重入

**12.分时系统追求的目标是(**

A.光分利用O设备    B.比较快速响应用户
C.提高系统吞吐率    D.充分利用内存

**13.在分时系统中,时间片一定时,()响应时间越长**

A.内存越多    B.内存越少
C.用户数越多    D.用户数越少

**14.在分时系统中,为使多个进程能够及时与系统交互,最关键的问题是能在短时间内,使所有就绪进程都能行,当就绪进程数为100时,为保证响应时间不超过2s,此时的时间片最大应为()**

A. 10ms    B.20ms
C.50ms    D.100m

**15.操作系统有多种类型。允许多个用户以交互的方式使用计算机的操作系统,称为()；允许多个用户将若干作业提交给计算机系统集中处理的操作系统,称为()；在()的控制下,计算机系统能及时处理由过程控制反馈的数据,并及时做出响应;在IBM-PC中,操作系统称为()**

A.批处理系统    B.分时操作系统
C.实时操作系统    D.微型计算机操作系统

**16.【2018统考真题】下列关于多任务操作系统的叙述中,正确的是(）**

Ⅰ.具有并发和并行的特点

Ⅱ.需要实现对共享资源的保护

Ⅲ.需要运行在多CPU的硬件平台上

A.仅Ⅰ   B.仅Ⅱ
C.仅Ⅰ、Ⅱ    D.Ⅰ、Ⅱ、Ⅲ

答案：

DDCBA  DBCBD

CBCBBACD  C

#### 2.8.2、综合应用题

1.批处理操作系统、分时操作系统和实时操作系统各有什么特点?

- 1)批处理操作系统的用户脱机使用计算机，作业是成批处理的,系统内多道程序并发执行,交互能力差。
- 2)分时操作系统可让多个用户同时使用计算机，人机交互性较强，具有每个用户独立使用计算机的独占性，系统响应及时。
- 3)实时操作系统能对控制对象做出及时反应,可靠性高,响应及时,但资源利用率低。

2.有两个程序，程序A依次使用CPU计10s、设备甲计5s、CPU计5s、设备乙计10s、CPU计10s；程序B依次使用设备甲计10s、CPU计10s、设备乙计5s,CPU计5s、设备乙计10s。在单道程序环境下先执行程序A再执行程序B，CPU的利用率是多少?在多道程序环境下,CPU利用率是多少?

- 单道环境下,CPU的运行时间为(1+5+10s+(10+5)s=40s,两个程序运行的总时间为40s+40s=80s,因此利用率是40/80=50%
- 多道环境下,CPU运行时间为40s,两个程序运行总时间为45s,因此利用率为40/45=88.9% 。

3.设某计算机系统有一个CPU、一台输入设备一台打印机。现有两个进程同时进入就绪态,且进程A先得到CPU运行,进程B后运行,进程A的运行轨为:计算50ms,打印信息100ms,再计算50ms,打信息100ms,结束,进程B的运行轨迹为:计算50ms,输入数据80ms,再计算100ms,结束。画出它们的时序关系图(可用甘特图)并说明:

1)开始运行后,CPU有无空闲等待?若有在哪段时内等待?计算CPU的利用率

2)进程A运行时有无等待现象?若有,在何时发生等待现象?

3)进程B运行时有无等待现象?若有,在何时发生等待现象?

进程运行情况如下图所示。

![os](http://images.zsjshao.net/ky/os/1/29.png)

1)CPU在100~150ms时间段内空,利用率为

2)进程A为无等待现象

3)进程B为有等待现象,0~50ms,180~200ms

## 3、操作系统的运行环境

### 3.1、操作系统的运行机制和体系结构

![os](http://images.zsjshao.net/ky/os/1/30.png)

预备知识：什么是指令

问题：“指令”和我们平时所说的“代码”有什么区别？

![os](http://images.zsjshao.net/ky/os/1/31.png)

简单来说，“指令”就是处理器（CPU）能识别、执行的最基本命令

比如：加法指令就是让CPU进行加法运算

#### 3.1.1、两种指令、两种处理器状态、两种程序

有的指令“人畜无害”。比如：加、减、乘、除这些普通的运算指令。

有的指令有很高的权限。比如：内存清零指令。如果用户程序可以使用这个指令，就意味着一个用户可以将其他用户的内存数据随意清零，这样做显然是很危险的。

![os](http://images.zsjshao.net/ky/os/1/32.png)

CPU如何判断当前是否可以执行特权指令？

![os](http://images.zsjshao.net/ky/os/1/33.png)

![os](http://images.zsjshao.net/ky/os/1/34.png)

操作系统的运行机制

![os](http://images.zsjshao.net/ky/os/1/35.png)

问题：操作系统中的哪些功能应该由内核程序实现呢？

#### 3.1.2、操作系统的内核

在软件工程思想和结构程序设计方法影响下诞生的现代操作系统,几乎都是层次式的结构。操作系统的各项功能分别被设置在不同的层次上。一些与硬件关联较紧密的模块，如时钟管理、中断处理、设备驱动等处于最低层。其次是运行频率较高的程序，如进程管理、存储器管理和设备管理等。这两部分内容构成了操作系统的内核。这部分内容的指令操作工作在核心态。

内核是计算机上配置的底层软件,是计算机功能的延伸,不同系统对内核的定义稍有区别,大多数操作系统内核包括4方面的内容。

- 时钟管理
  - 在计算机的各种部件中,时钟是最关键的设备,时钟的第一功能是计时,操作系统需要通过时钟管理,向用户提供标准的系统时间。另外,通过时钟中断的管理,可以实现进程的切换。例如,在分时操作系统中采用时间片轮转调度，在实时系统中按截止时间控制运行,在批处理系统中通过时钟管理来衡量一个作业的运行程度等。因此,系统管理的方方面面无不依赖于时钟
- 中断机制
  - 引入中断技术的初表是提高多道程序运行环境中CPU的利用率,而且主要是针对外部设备的。后来逐步得到发展,形成了多种类型,成为操作系统各项操作的基础。
- 原语
- 系统控制的数据结构及处理

![os](http://images.zsjshao.net/ky/os/1/36.png)

内核是计算机上配置的底层软件，是操作系统最基本、最核心的部分。

实现操作系统内核功能的那些程序就是内核程序。

![os](http://images.zsjshao.net/ky/os/1/37.png)

#### 3.1.3、操作系统的体系结构

大内核和微内核

![os](http://images.zsjshao.net/ky/os/1/38.png)

![os](http://images.zsjshao.net/ky/os/1/39.png)

#### 3.1.4、总结

![os](http://images.zsjshao.net/ky/os/1/40.png)

### 3.2、中断和异常

![os](http://images.zsjshao.net/ky/os/1/41.png)

#### 3.2.1、中断机制的诞生

![os](http://images.zsjshao.net/ky/os/1/42.png)

为了解决上述问题，人们发明了操作系统（作为计算机的管理者），引入中断机制，实现了多道程序并发执行

本质：发生中断就意味着需要操作系统介入，开展管理工作

![os](http://images.zsjshao.net/ky/os/1/43.png)

#### 3.2.2、中断的概念和作用

在操作系统中引入核心态和用户态这两种工作状态后,就需要考虑这两种状态之间如何切换。操作系统内核工作在核心态,而用户程序工作在用户态。

1、当中断发生时，CPU立即进入核心态

2、当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断就行处理

3、对于不同的中断信号，会进行不同的处理

发生中断就意味着需要操作系统介入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配I/O设备等）需要使用特权指令，因此CPU要从用户态转换为核心态。中断可以使CPU从用户态切换为核心态，使操作系统获得计算机的控制权。有了中断，才能实现多道程序并发执行。

![os](http://images.zsjshao.net/ky/os/1/44.png)

遗留问题：用户态、核心态之间的切换是怎么实现的？

答：”用户态->核心态“由“中断”引发，硬件自动完成变换过程，触发中断信号意味着操作系统将强行夺回CPU的使用权。

- “中断”是让操作系统内核夺回CPU使用权的唯一途径

”核心态->用户态“的切换是通过执行一个特权指令，将程序状态字（PSW）的标志位设置为”用户态“”，这个动作意味着操作系统将主动让出CPU使用权

#### 3.2.3、中断的分类

![os](http://images.zsjshao.net/ky/os/1/45.png)

另一种分类方式：

![os](http://images.zsjshao.net/ky/os/1/46.png)

大多数的教材、试卷中，“中断”特指狭义的中断，即外中断。而内中断一般称为“异常”

外中断的处理过程

![os](http://images.zsjshao.net/ky/os/1/47.png)

#### 3.2.4、总结

![os](http://images.zsjshao.net/ky/os/1/48.png)

### 3.3、系统调用

![os](http://images.zsjshao.net/ky/os/1/49.png)

#### 3.3.1、什么是系统调用，有何作用？

知识点回顾：

操作系统作为用户和计算机硬件之间的接口，需要向上提供一些简单易用的服务。主要包括命令接口和程序接口。其中，程序接口由一组系统调用组成。

![os](http://images.zsjshao.net/ky/os/1/50.png)

“系统调用”是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以通过系统调用来请求获得操作系统内核的服务。

问题：操作系统为什么要提供**系统调用**功能？

生活场景：去学校打印店打印论文，你按下了WPS 的“打印”选项，打印机开始工作。

你的论文打印到一半时，另一位同学按下了Word 的“打印”按钮，开始打印他自己的论文。

思考：如果两个进程可以随意地、并发地共享打印机资源，会发生什么情况？

两个进程并发运行，打印机设备交替地收到WPS 和Word 两个进程发来的打印请求，结果两篇论文的内容混杂在一起了…

解决方法：由操作系统内核对共享资源进行统一的管理，并向上提供“系统调用” ，用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统内核发出请求。内核会对各个请求进行协调处理。



应用程序通过系统调用请求操作系统的服务。而系统中的各种共享资源都由操作系统内核统一掌管，因此凡是与共享资源有关的操作（如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统内核提出服务请求，由操作系统内核代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。

![os](http://images.zsjshao.net/ky/os/1/51.png)

#### 3.3.2、系统调用与库函数的区别

![os](http://images.zsjshao.net/ky/os/1/52.png)

#### 3.3.3、系统调用背后的过程

![os](http://images.zsjshao.net/ky/os/1/53.png)

![os](http://images.zsjshao.net/ky/os/1/54.png)

![os](http://images.zsjshao.net/ky/os/1/55.png)

传递系统调用参数 -> 执行陷入指令（用户态）-> 执行相应的内请求核程序处理系统调用（核心态）-> 返回应用程序

注意：

- 1.陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，使CPU进入核心态
- 2.发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行
- 3.陷入指令是唯一一个只能在用户态执行，而不可在核心态执行的指令。

#### 3.3.4、总结

![os](http://images.zsjshao.net/ky/os/1/56.png)

### 3.4、习题

#### 3.4.1、单项选择题

**1.下列关于操作系统的说法中,错误的是()**

Ⅰ.在通用操作系统管理下的计算机上运行程序。需要向操作统预定运行时间

Ⅱ.在通用操作系统管理下的计算机上运行程序,需要确定起始地址,并从这个地址开始执行

Ⅲ操作系统需要提供高级程序设计语言的编译器

Ⅳ.管理计算机系统资源是操作系统关心的主要问题

A.Ⅰ、Ⅲ    B.Ⅱ、Ⅲ
C.Ⅰ、Ⅱ、Ⅲ、Ⅳ    D.以上答案都正确

**2.下列说法中,正确的是()**

Ⅰ.批处理的主要缺点是需要大量内存

Ⅱ.当计算机提供了核心态和用户态时,输入输出指今必须在核心态下执行

Ⅲ.操作系统中采用多道程序设计技术的最主要原因是为了提高CPU和外部设备的可靠性

Ⅳ.操作系统中,通道技术是一种硬件技术

A.Ⅰ、Ⅱ    B.Ⅰ、Ⅲ
C.Ⅱ、Ⅳ    D.Ⅱ、Ⅲ、Ⅳ

**3.下列关于系统调用的说法中,正确的是()**

Ⅰ.用户程序设计时,使用系统调用命令,该命令经过编译后,形成若干参数和陷入(tap)指令

Ⅱ.用户程序设计时,使用系统调用命令,该命令经过编译后,形成若干参数和屏蔽中断指令

Ⅲ.系统调用功能是操作系统向用户程序提供的接口

Ⅳ.用户及其应用程序和应用系统是通过系统调用提供的支持和服务来使用系统资源完成其操作的

A.Ⅰ、Ⅲ    B.Ⅱ、Ⅳ
C.Ⅰ、Ⅲ、Ⅳ    D.Ⅱ、Ⅲ、Ⅳ

**4.()是操作系统必须提供的功能**

A.图形用户界面(GUI)    B.为进程提供系统调用命令
C.中断处理    D.编译源程序

**5.用户程序在用户态下要使用特权指令引起的中断属于()**

A.硬件故障中断    B.程序中断
C.外部中断    D.访管中断

**6.处理器执行的指令被分为两类,其中有一类称为特权指令,它只允许()使用**

A.操作员    B.联机用户
C.目标程序    D.操作系统

**7.下列操作系统的各个功能组成部分中,()可不需要硬件的支持**

A.进程调度    B.时钟管理
C.地址映射    D.中断系统

**8.在中断发生后,进入中断处理的程序属于()**

A.用户程序    B.可能是应用程序,也可能是操作系统程序
C.操作系统程序    D.既不是应用程序,又不是操作系统程序

**9.计算机区分核心态和用户态指令后,从核心态到用户态的转换是由操作系统程序执行后完成的,而用户态到核心态的转换则是由(）完成的。**

A.硬件    B.核心态程序
C.用户程序    D.中断处理程序

**10.【2011统考真题】下列选项中,在用户态执行的是()**

A.命令解释程序    B.缺页处理程序
C.进程调度程序    D.时钟中断处理程序

**11.【2012统考真题】下列选项中,不可能在用户态发生的事件是()**

A.系统调用    B.外部中断
C.进程切换    D.缺页

**12.只能在核心态下运行的指令是()**

A.读时钟指令    B.置时钟指令
C.取数指令    D.寄存器清零

**13.“访管”指令（）使用**

A.仅在用户态下    B.仅在核心态下
C.在规定时间内    D.在调度时间内

**14.当CPU执行操作系统代码时,处理器处于()**

A.自由态    B.用户态
C.核心态    D.就绪态

**15.在操作系统中,只能在核心态下执行的指令是()**

A.读时钟    B.取数
C.广义指令    D.寄存器清”0“

**16.下列选项中,必须在核心态下执行的指今是()**

A.从内存中取数    B.将运算结果装入内存
C.算术运算    D.输入/输出

**17.CPU处于核心态时,它可以执行的指令是()**

A.只有特权指令    B.只有非特权指令
C.只有“访管”指令    D.除“访管”指令的全部指令

**18.【2013统考真题】下列选项中,会导致用户进程从用户态切换到内核态的操作是()**

Ⅰ.整数除以零 Ⅱ.sin()函数调用 Ⅲ.read系统调用

A.仅Ⅰ、Ⅱ
B.仅Ⅰ、Ⅲ
C.仅Ⅱ、Ⅲ
D.Ⅰ、Ⅱ和Ⅲ

**19.()程序可执行特权指令**

A.同组用户    B.操作系统
C.特权用户    D.一般用户

**20.【2012统考真题】中断处理和子程序调用都需要压栈以保护现场，中断处理一定会保存而子程序调用不需要保存其内容的是()**

A.程序计数器    B.程序状态字寄存器
C.通用数据寄存器    D.通用地址寄存器

**21.【2014统考真题】下列令中,不能在用户态执行的是()**

A.trap指令    B.跳转指令
C,压栈指令    D.关中断指令

**22.【2015统考真题】内部异常(内中断)可分为故障( fault)、陷阱(tap)和终止(abort)三类,下列有关内部异常的叙述中,错误的是()**

A.内部异常的产生与当前执行指令相关    B.内部异常的检测由CPU内部逻辑实现
C.内部异常的响应发生在指令执行过程中    D.内部异常处理后返回到发生异常的指令继续执行

**23.【2016统考真题】异常是指令执行过程中在处理器内部发生的特殊事件,中断是来自处理器外部的请求事件。下列关于中断或异常情况的叙述中,错误的是()**

A.“访存时缺页”属于中断    B.“整数除以0”属于异常
C.DMA传送结束”属于中断    D.“存储保护错”属于异常

**24.【2015统考真题】处理外部中断时,应该由操作系统保存的是()**

A.程序计数器(PC)的内容    B.通用寄存器的内容
C.块表(TLB)中的内容    D. Cache中的内容

**25.【2015统考真题】假定下列指令已装入指令寄存器,则执行时不可能导致CPU从用户态变为内核态(系统态)的是()**

A. DIV R0, R1    ;(R0)/(R1)→R0

B. INT n             ;产生软中

C.NOT R0          ;寄存器R0的内容取非
D. MOV R0,addr      ;把地址addr处的内存数据放入寄存器R0

**26.【2017统考真题】执行系统调用的过程包括如下主要操作:**
①返回用户态              ②执行陷入(trap)指今
③传递系统调用参数  ④执行相应的服务程序
正确的执行顺序是()

A.②→③→①→④
B.②→④→③→①
C.③→②→④→①
D.③→④→②→①

**27.【2018统考真题】定时器产生时钟中断后,由时钟中断服务程序更新的部分内容是()**

Ⅰ.内核中时钟变量的值

Ⅱ.当前进程占用CPU的时间

Ⅲ.当前进程在时间片内的剩余执行时间

A.仅Ⅰ、Ⅱ
B.仅Ⅱ、Ⅲ
C.仅Ⅰ、Ⅲ
D.Ⅰ、Ⅱ、Ⅲ

**28.【2019统考真题】下列关于系统调用的叙述中,正确的是()**

Ⅰ.在执行系统调用服务程序的过程中,CPU处于内核态

Ⅱ.操作系统通过提供系统调用避免用户程序直接访问外设

Ⅲ.不同的操作系统为应用程序提供了统一的系统调用接口

Ⅳ.系统调用是操作系统内核为应用程序提供服务的接口

A.Ⅰ、Ⅳ
B.仅Ⅱ、Ⅲ
C.仅Ⅰ、Ⅱ、Ⅳ
D.仅Ⅰ、Ⅲ、Ⅳ

**29.相对于传统操作系统结构,采用微内核结构设计和实现操作系统具有诸多好处,下列()是微内核结构的特点**

Ⅰ.使系统更高效      Ⅱ.添加系统服务时,不必修改内核
Ⅲ.微内核结构没有单一内核稳定        Ⅳ.使系统更可靠

A.Ⅰ、Ⅲ、Ⅳ
B.Ⅰ、Ⅱ、Ⅳ
C.Ⅱ、Ⅳ
D.Ⅰ、Ⅳ



答案：

ACCCD  DACAA

CBACC  DDBBB

DDABC  CDCC

#### 3.4.2、综合应用题

1.处理器为什么要区分核心态和用户态两种操作方式?在什么情况下进行两种方式的切换?

- 区分执行态的主要目的是保护系统程序。用户态到核心态的转换发生在中断产生时,而核心态到用户态的转换则发生在中断返回用户程序时。

2.为什么说直到出现中断和通道技术后,多道程序概念才变得有用?

- 多道程序并发执行是指有的程序正在CPU上执行,而另一些程序正在I/O设备上进行传输,即通过CPU操作与外设传输在时间上的重叠必须有中断和通道技术的支持,原因如下：
- 1)通道是一种控制一台或多台外部设备的硬件机构,它一旦被启动就独立于CPU运行,因而做到了输入输出操作与CPU并行工作。但早期CPU与通道的联络方法是由CPU向通道发出询间指令来了解通道工作是否完成的。若未完成,则主机就循环询问直到通道工作结束为止。因此,这种询问方式是无法真正做到CPU与I/O设备井行工作的。
- 2)在硬件上引入了中断技术,所谓中断,就是在输入输出结束时,或硬件发生某种故障时,由相应的硬件(即中断机构)向CPU发出信号,这时CPU立即停下工作而转向处理中断请求,待处理完中断后再继续原来的工作。
- 因此,通道技术和中断技术结合起来就可实现CPU与I/O设备并行工作,即CPU启动通道传输数据后便去执行其他程序的计算工作而通道则进行输入/输出操作:当通道工作结束时,再通过中断机构向CPU发出中断请求,CP则暂停正在执行的操作,对出现的中断进行处理,处理完后再继续原来的工作。这样,就真正做到了CPU与I/O设备并行工作,此时,多道程序的概念才变为现实。

## 4、本章疑难点

### 1.并行性与并发性的区别和联系

并行性和并发性是既相似又有区别的两个概念,并行性是指两个或多个事件在同一时刻发生,并发性是指两个或多个事件在同一时间间隔内发生

在多道程序环境下,并发性是指在一段时间内,宏观上有多个程序同时运行,但在单处理器系统中每个时刻却仅能有一道程序执行,因此微观上这些程序只能分时地交替执行。若在计算机系统中有多个处理器,则这些可以并发执行的程序便被分配到多个处理器上,实现并行执行,即利用每个处理器来处理一个可并发执行的程序。

### 2.特权令与非特权指

所谓特权指令,是指有特殊权限的指令,由于这类指令的权限最大,使用不当将导致整个系统崩溃,如清内存、置时钟、分配系统资源、修改虚存的段表或页表、修改用户的访问权限等。若所有程序都能使用这些指令,则系统一天死机n次就不足为奇。为保证系统安全,这类指令只能用于操作系统或其他系统软件,不直接提供给用户使用。因此,特权指令必须在核心态执行。实际上,CPU在核心态下可以执行指令系统的全集。形象地说,特权指令是那些儿童不宜的东西,而非特权指令是老少皆宜的东西。

为了防止用户程序中使用特权指令,用户态下只能使用非特权指令,核心态下可以使用全部指令。在用户态下使用特权指令时,将产生中断以阻止用户使用特权指令。所以把用户程序放在用户态下运行,而操作系统中必须使用特权指令的那部分程序在核心态下运行,保证了计算机系统的安全可靠。从用户态转换为核心态的唯一途径是中断或异常。

### 3.访管指令与访管中断

访管指令是一条可以在用户态下执行的指令。在用户程序中,因要求操作系统提供服务而有意识地使用访管指令,从而产生一个中断事件（自愿中断)，将操作系统转换为核心态,称为访管中断。访管中断由访管指令产生,程序员使用访管指令向操作系统请求服务。

为什么要在程序中引入访管指令呢?这是因为用户程序只能在用户态下运行。若用户程序想要完成在用户态下无法完成的工作,该怎么办？解决这个问题要靠访管指令。访管指令本身不是特权指令,其基本功能是让程序拥有“自愿进管”的手段,从而引起访管中断

处于用户态的用户程序使用访管指令时,系统根据访管指令的操作数执行访管中断处理程序,访管中断处理程序将按系统调用的操作数和参数转到相应的例行子程序。完成服务功能后,退出中断,返回到用户程序断点继续执行。