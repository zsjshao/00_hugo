+++
author = "zsjshao"
title = "02_进程管理"
date = "2021-01-01"
tags = ["OS"]
categories = ["OS"]

+++

# 进程管理

知识框架

![os](http://images.zsjshao.net/ky/os/2/01.png)

## 1、进程的定义、组成、组织方式和特征

### 1.1、进程的定义

程序：就是一个指令序列

在多道程序环境下,允许多个程序并发执行,此时它们将失去封闭性,并具有间断性及不可再现性的特征。为此引入了进程(Process)的概念以便更好地描述和控制程序的并发执行,实现操作系统的并发性和共享性(最基本的两个特性)

为了使参与并发执行的程序(含数据)能独立地运行,必须为之配置一个专门的数据结构,称为进程控制块(Process Control Block,PCB)系统利用PCB来描述进程的基本情况和运行状态,进而控制和管理进程。相应地,由程序段相关数据段和PCB三部分构成了进程映像(进程实体)所谓创建进程,实质上是创建进程映像中的PCB:而撤销进程,实质上是撤销进程的PCB值得注意的是,进程映像是静态的,进程则是动态的。

注意:PCB是进程存在的唯一标志!

从不同的角度,进程可以有不同的定义,比较典型的定义有:

- 1)进程是程序的一次执行过程
- 2)进程是一个程序及其数据在处理机上顺序执行时所发生的活动。
- 3)进程是具有独立功能的程序在一个数据集合上运行的过程,它是系统进行资源分配和调度的一个独立单位“。

引入进程实体的概念后,我们可以把传统操作系统中的进程定义为：“进程是进程实体的运行过程,是系统进行资源分配和调度的一个独立单位。

这里说的系统资源。它指处理机、存储器和其他设备服务于某个进程的“时间”,例如把处理机资源理解为处理机的时间片才是准确的。因为进程是这些资源分配和调度的独立单位,即“时间片”分配的独立单位,这就决定了进程一定是一个动态的、过程性的概念。

### 1.2、进程的组成

进程是一个独立的运行单位,也是操作系统进行资源分配和调度的基本单位。它由程序段、数据段、PCB三部分组成,其中最核心的是进程控制块(PCB)

![os](http://images.zsjshao.net/ky/os/2/02.png)

![os](http://images.zsjshao.net/ky/os/2/04.png)

#### 1.2.1、进程控制块

进程创建时,操作系统为它新建一个PCB,该结构之后**常驻内存**,任意时刻都可以存取,并在进程结束时删除。PCB是进程实体的一部分,是进程存在的唯一标志。

进程执行时,系统通过其PCB了解进程的现行状态信息,以便对其进行控制和管理;进程结束时,系统收回其PCB,该进程随之消亡。操作系统通过PCB表来管理和控制进程

当操作系统欲调度某进程运行时,要从该进程的PCB中查出其现行状态及优先级;在调度到某进程后,要根据其PCB中所保存的处理机状态信息,设置该进程恢复运行的现场,并根据其PCB中的程序和数据的内存始址,找到其程序和数据:进程在运行过程中,当需要和与之合作的进程实现同步、通信或访问文件时,也需要访问PCB当进程由于某种原因而暂停运行时,又需将其断点的处理机环境保存在PCB中,可见,在进程的整个生命期中,系统总是通过PCB对进程进行控制的,亦即系统唯有通过进程的PCB才能感知到该进程的存在

PCB主要包括进程描述信息、进程控制和管理信息、资源分配清单和处理机相关信息等。

![os](http://images.zsjshao.net/ky/os/2/03.png)

![os](http://images.zsjshao.net/ky/os/2/05.png)

1)进程描述信息。进程标识符:标志各个进程,每个进程都有一个唯一的标识号。用户标识符:进程归属的用户,用户标识符主要为共享和保护服务。

2)进程控制和管理信息,进程当前状态:描述进程的状态信息,作为处理机分配调度的依据。进程优先缓:描述进程抢占处理机的优先级,优先级高的进程可优先获得处理机。

3)资源分配清单,用于说明有关内存地址空间或虚拟地址空间的状况,所打开文件的列表和所使用的输入输出设备信息。

4)处理机相关信息,主要指处理机中各寄存器的值,当进程被切换时,处理机状态信息都必须保存在相应的PCB中,以便在该进程重新执行时,能从断点继续执行。

#### 1.2.2、程序段

程序段就是能被进程调度程序调度到CPU执行的程序代码段注意,程序可被多个进程共学,即多个进程可以运行同一个程序

#### 1.2.3、数据段

一个进程的数据段,可以是进程对应的程序加工处理的原始数据,也可以是程序执行时产生的中间或最终结果。

### 1.3、进程的组织方式

在一个系统中,通常存在着许多进程的PC,有的处于就绪态,有的处于阻塞态,而且阻塞的原因各不相同,为了方便进程的调度和管理,需要将各进程的PCB用适当的方法组织起来。目前,常用的组织方式有链接方式和索引方式两种,链接方式将同一状态的PCB链接成一个队列,不同状态对应不同的队列,也可把处于阻塞态的进程的PCB,根据其阻塞原因的不同,排成多个阻塞队列,索引方式将同一状态的进程组织在一个索引表中,索引表的表项指向相应的PCB,不同状态对应不同的索引表,如就绪索引表和阻塞索引表等。

![os](http://images.zsjshao.net/ky/os/2/06.png)

链接方式

![os](http://images.zsjshao.net/ky/os/2/07.png)

索引方式

![os](http://images.zsjshao.net/ky/os/2/08.png)

### 1.4、进程的特征

进程是由多道程序的并发执行而引出的,它和程序是两个截然不同的概念。进程的基本特征是对比单个程序的顺序执行提出的,也是对进程管理提出的基本要求

- 1)动态性。进程是程序的一次执行,它有着创建、活动、暂停、终止等过程,具有一定的生命周期,是动志地产生,变化和消亡的,动态性是进程最基本的特征
- 2)并发性。指多个进程实体同时存于内存中,能在一段时间内同时运行,并发性是进程的重要特征,同时也是操作系统的重要特征,引入进程的目的就是为了使程序能与其他进程的程序并发执行,以提高资源利用率
- 3)独立性。指进程实体是一个能独立运行、独立获得资源和独立接受调度的基本单位,凡未建立PCB的程序,都不能作为一个独立的单位参与运行。
- 4)异步性,由于进程的相互制约,使得进程具有执行的间断性,即进程按各自独立的、不可预知的速度向前推进。异步性会导致执行结果的不可再现性,为此在操作系统中必须配置相应的进程同步机制
- 5)结构性。每个进程都配置一个PCB对其进行描述。从结构上看,进程实体是由程序、数据段和进程控制块三部分组成的。

![os](http://images.zsjshao.net/ky/os/2/09.png)

### 1.5、总结

![os](http://images.zsjshao.net/ky/os/2/10.png)

## 2、进程的状态与转换

![os](http://images.zsjshao.net/ky/os/2/11.png)

### 2.1、进程的状态

进程在其生命周期内,由于系统中各进程之间的相互制约关系及系统的运行环境的变化,使得进程的状态也在不断地发生变化(一个进程会经历若干不同状态)。通常进程有以下五种状态,前三种是进程的基本状态。

- 1)运行态。进程正在处理机上运行。在单处理机环境下,每个时刻最多只有一个进程处于运行态
- 2)就绪态,进程获得了除处理机外的一切所需资源,一且得到处理机,便可立即运行素统中处于就绪状态的进程可能有多个,通常将它们排成一个队列,称为就绪队列
- 3)阻塞态,又称等待态。进程正在等待某一事件而暂停运行,如等待某资源为可用(不包括处理机)或等待输入输出完成。即使处理机空闲,该进程也不能运行
- 4)创建态。进程正在被创建,尚未转到就绪态。创建进程通常需要多个步骤:首先申请一个空白的PCB,并向PCB中填写一些控制和管理进程的信息然后由系统为该进程分配运行时所必需的资源;最后把该进程转入就结态。
- 5)结束态。进程正从系统中消失,可能是进程正常结束或其他原因中断退出运行,进程需要结运行时,系统首先必须置该进程为结束态,然后再进一步处理资源释放和回收等工作

注意区别就绪态和等待态:就绪态是指进程仅缺少处理机,只要获得处理机资源就立即运行而等待态是指进程需要其他资源(除了处理机或等待某一事件。

### 2.2、进程状态的转换

![os](http://images.zsjshao.net/ky/os/2/12.png)

需要注意的是,一个进程从运行态变成阻塞态是主动的行为,而从阻塞态变成就绪态是被动的行为,需要其他相关进程的协助

### 2.3、总结

![os](http://images.zsjshao.net/ky/os/2/13.png)

## 3、进程控制

![os](http://images.zsjshao.net/ky/os/2/14.png)

进程控制的主要功能是对系统中的所有进程实施有效的管理,它具有创建新进程、撤销已有进程、实现进程状态转换等功能。

简化理解：反正进程控制就是要实现进程状态转换

![os](http://images.zsjshao.net/ky/os/2/15.png)

在操作系统中,一般把进程控制用的程序段称为原语,原语的特点是执行期间不允许中断,只能一气呵成，它是一个不可分割的基本单位。这种不可被中断的操作即原子操作。

原语采用”关中断指令”和“开中断指令”实现

![os](http://images.zsjshao.net/ky/os/2/16.png)

显然，关/开中断指令的权限非常大，必然是只允许在核心态下执行的特权指令。

**进程控制相关的原语**

进程控制会导致进程状态的切换。无论哪个原语，要做的无非三类事情：

- 1.更新PCB中的信息（如修改进程状态标志、将运行环境保存到PCB、从PCB恢复运行环境）
  - a.所有的进程控制原语一定都会修改进程状态标志
  - b.剥夺当前运行进程的CPU使用权必然需要保存其运行环境
  - c.某进程开始运行前必然要恢复其运行环境
- 2.将PCB插入合适的队列
- 3.分配/回收资源

### 3.1、进程创建

允许一个进程创建另一个进程。此时创建者称为父进程,被创建的进程称为于进程。子进程可以继承父进程所拥有的资源。当子进程被撤销时,应将其从父进程那里获得的资源归还给父进程。此外,在撤销父进程时,必须同时撤销其所有的子进程。

在操作系统中,终端用户登录系统、作业调度系统提供服务、用户程序的应用请求等都会引起进程的创建。操作系统创建一个新进程的过程如下(创建原语)

- 1)为新进程分配一个唯一的进程标识号,并申请一个空白的PCB(PCB是有限的)若PCB申请失败,则创建失败。

- 2)为进程分配资源,为新进程的程序和数据及用户分配必要的内存空间(在PCB中体现)

  注意,若资源不足(如内存空间),则并不是创建失败,而是处于阻塞态,等待内存资源

- 3)初始化PCB,主要包括初始化标志信息、初始化处理机状态信息和初始化处理机控制信总,以及设置进程的优先级等

- 4)若进程就绪队列能够接纳新进程,则将新进程插入就绪队列,等待被调度运行

![os](http://images.zsjshao.net/ky/os/2/17.png)

### 3.2、进程终止

引起进程终止的事件主要有:①正常结束,表示进程的任务已完成并准备退出运行。②异常结束,表示进程在运行时,发生了某种异常事件,使程序无法继续运行,如存储区越界、保护错、非法指令、特权指令错、运行超时、算术运算错、I/O故障等。③外界干预,指进程应外界的请求而终止运行,如操作员或操作系统干预、父进程请求和父进程终止

操作系统终止进程的过程如下(撤销原语)：

- 1)根据被终止进程的标识符,检索PCB,从中读出该进程的状态
- 2)若被终止进程处于执行状态,立即终止该进程的执行,将处理机资源分配给其他进程
- 3)若该进程还有子孙进程,则应将其所有子孙进程终止
- 4)将该进程所拥有的全部资源,或归还给其父进程,或归还给操作系统
- 5)将该PCB从所在队列(链表)中删除。

![os](http://images.zsjshao.net/ky/os/2/18.png)

### 3.3、进程阻塞和唤醒

正在执行的进程,由于期待的某些事件未发生，如请求系统资源失败,等待某种操作的完成、新数据尚未到达或无新工作可做等,由系统自动执行阻塞原语(Block)，使自己由运行态变为阻塞态。可见，进程的阻塞是进程自身的一种主动行为,也因此只有处于运行态的进程(获得CPU),才可能将其转为阻塞态。

阻塞原语的执行过程如下:

- 1)找到将要被阻塞进程的标识号对应的PCB。
- 2)若该进程为运行态,则保护其现场,将其状态转为阻塞态,停止运行。
- 3)把该PCB插入相应事件的等待队列,将处理机资源调度给其他就绪进程。

当被阻塞进程所期待的事件出现时,如它所启动的I/O操作已完成或其所期待的数据已到达,由有关进程(比如,释放该I/O设备的进程,或提供数据的进程)调用唤醒原语(Wakeup),将等待该事件的进程唤醒。

唤醒原语的执行过程如下:

- 1)在该事件的等待队列中找到相应进程的PCB
- 2)将其从等待队列中移出,并置其状态为就绪态
- 3)把该PCB插入就绪队列,等待调度程序调度。

需要注意的是, Block原语和 Wakeup原语是一对作用刚好相反的原语,必须成对使用, Block原语是由被阻塞进程自我调用实现的,而 Wakeup原语则是由一个与被唤醒进程合作或被其他相关的进程调用实现的

![os](http://images.zsjshao.net/ky/os/2/19.png)

### 3.4、进程切换

对于通常的进程而言,其创建、撤销及要求由系统设备完成的I/O操作,都是利用系统调用而进入内核,再由内核中的相应处理程序予以完成的。进程切换同样是在内核的支持下实现的，因此可以说,任何进程都是在操作系统内核的支持下运行的,是与内核紧密相关的。

进程切换是指处理机从一个进程的运行转到另一个进程上运行,在这个过程中,进程的运行环境产生了实质性的变化。

进程切换的过程如下:

- 1)保存处理机上下文,包括程序计数器和其他寄存器
- 2)更新PCB信息
- 3)把进程的PCB移入相应的队列,如就绪、在某事件阻塞等队列。
- 4)选择另一个进程执行,并更新其PCB
- 5)更新内存管理的数据结构
- 6)恢复处理机上下文

注意,进程切换与处理机模式切换是不同的,模式切换时,处理机逻辑上可能还在同一进程中运行。若进程因中断或异常进入核心态运行,执行完后又回到用户态刚被中断的程序运行,则操作系统只需恢复进程进入内核时所保存的CPU现场,而无须改变当前进程的环境信息。但若要切换进程,当前运行进程改变了,则当前进程的环境信息也需要改变。

注意:“调度”和“切换”的区别。调度是指决定资源分配给哪个进程的行为,是一种决策行为;切换是指实际分配的行为,是执行行为。一般来说,先有资源的调度,然后才有进程的切换

![os](http://images.zsjshao.net/ky/os/2/20.png)

### 3.5、总结

![os](http://images.zsjshao.net/ky/os/2/21.png)

## 4、进程通信

![os](http://images.zsjshao.net/ky/os/2/22.png)

进程是分配系统资源的单位（包括内存地址空间），因此各进程拥有的内存地址空间相互独立。

进程通信是指进程之间的信息交换。PV操作(第3节是低级通信方式,高级通信方式是指以较高的效率传输大量数据的通信方式高级通信方法主要有以下三类

### 4.1、共享存储

在通信的进程之间存在一块可直接访问的共享空间,通过对这片共享空间进行写读操作实现进程之间的信息交换,在对共享空间进行写/读操作时,需要使用同步互斥工具(如P操作、V操作),对共享空间的写读进行控制。

共享存储又分为两种:低级方式的共享是基于数据结构的共享;高级方式的共享则是基于存储区的共享。操作系统只负责为通信进程提供可共享使用的存储空间和同步互斥工具,而数据交换则由用户自己安排读写指令完成

![os](http://images.zsjshao.net/ky/os/2/23.png)

基于数据结构的共享：比如共享空间里只能放一个长度为10的数组。这种共享方式速度慢、限制多，是一种低级通信方式

基于存储区的共享：在内存中画出一块共享存储区，数据的形式、存放位置都由进程控制，而不是操作系统。相比之下，这种共享方式速度更快，是一种高级通信方式。

注意,用户进程空间一般都是独立的,进程运行期间一般不能访问其他进程的空间,要想让两个用户进程共享空间,必须通过特殊的系统调用实现,而进程内的线程是自然共享进程空间的。

### 4.2、管道通信

管道通信是消息传递的一种特殊方式(见图2.4),所谓“管道”,是指用于连接一个读进程和一个写进程以实现它们之间的通信的一个共享文件,又名pipe文件,向管道(共享文件)提供输入的发送进程(即写进程),以字符流形式将大量的数据送入(写)管道而接收管道输出的接收进程(即读进程)则从管道中接收(读)数据。

为了协调双方的通信,管道机制必须提供以下三方面的协调能力:互斥、同步和确定对方的存在

![os](http://images.zsjshao.net/ky/os/2/24.png)

下面以 LinuxLinux中的管道为例进行说明。在中,管道是一种使用非常频繁的通信机制从本质上说,管道也是一种文件,但它又和一般的文件有所不同,管道可以克服使用文件进行通信的两个问题,具体表现如下:

- 1)限制管道的大小。实际上,管道是一个固定大小的缓冲区,在 Linux中,该缓冲区的大小为4KB,这使得它的大小不像文件那样不加检验地增长,使用单个固定缓冲区也会带来问题,比如在写管道时可能变满,这种情况发生时,随后对管道的 write调用将默认地被阻塞,等待某些数据被读取,以便腾出足够的空间供 write调用写
- 2)读进程也可能工作得比写进程快,当所有当前进程数据已被读取时,管道变空当这种情况发生时,一个随后的 reado调用将默认地被阻塞,等特某些数据被写入,这解决了 read()调用返回文件结束的问题。

注意:从管道读数据是一次性操作,数据一旦被读取,它就从管道中被抛弃,释放空间以便写更多的数据管道只能采用双工通信,即某一时刻只能单向传输,要实现父子进程双方互动通信,需要定义两个管道

管道可以理解为共享存储的优化和发展,因为在共享存储中,若某进程要访问共享存储空间,则必须没有其他进程在该共享存储空间中进行写操作,否则访问行为就会被阻塞。而管道通信中,存储空间进化成了缓冲区,缓冲区只允许一边写入、另一边读出,因此只要缓冲区中有数据,进程就能从缓冲区中读出,而不必担心会因为其他进程在其中进行写操作而遭到阻塞,因为写进程会先把缓冲区写满,然后才让读进程读,当缓冲区中还有数据时,写进程不会往缓冲区写数据。当然,这也决定了管道通信必然是半双工通信。

### 4.3、消息传递

在消息传递系统中,进程间的数据交换是以格式化的消息(Message)为单位的。若通信的进程之间不存在可直接访问的共享空间,则必须利用操作系统提供的消息传递方法实现进程通信。进程通过系统提供的发送消息和接收消息两个原语进行数据交换。

- 1)直接通信方式。发送进程直接把消息发送给接收进程,并将它挂在接收进程的消息缓冲队列上,接收进程从消息缓冲队列中取得消息
- 2)间接通信方式发送进程把消息发送到某个中间实体,接收进程从中间实体取得消息这种中间实体一般称为信箱,这种通信方式又称信箱通信方。该通信方式广泛应用于计算机网络中,相应的通信系统称为电子邮件系统。

简单理解就是,甲要告诉乙某些事情,就要写信,然后通过邮差送给乙。直接通信就是邮差把信直接送到乙的手上;间接通信就是乙家门口有一个邮箱,邮差把信放到邮箱里

![os](http://images.zsjshao.net/ky/os/2/25.png)

### 4.4、总结

![os](http://images.zsjshao.net/ky/os/2/26.png)

## 5、线程、多线程模型

![os](http://images.zsjshao.net/ky/os/2/27.png)

### 5.1、线程的基本概念

引入进程的目的是为了更好地使多道程序并发执行,提高资源利用率和系统吞吐量:而引入线程的目的则是为了减小程序在井发执行时所付出的时空开销,提高操作系统的并发性能。

线程最直接的理解就是“轻量级进程”,它是一个基本的CPU执行单元,也是程序执行流的最小单元,由线程ID、程序计数器、寄存器集合和堆栈组成。线程是进程中的一个实体,是被系统独立调度和分派的基本单位,线程自己不拥有系统资源,只拥有一点儿在运行中必不可少的资源,但它可与同属一个进程的其他线程共享进程所拥有的全部资源。一个线程可以创建和撤销另一个线程,同一进程中的多个线程之间可以并发执行。由于线程之间的相互制约,致使线程在运行中呈现出间断性,线程也有就绪、阻塞和运行三种基本状态。

引入线程后,进程的内涵发生了改变,进程只作为除CPU外的系统资源的分配单元,而线程则作为处理机的分配单元。由于一个进程内部有多个线程,若线程的切换发生在同一个进程内部,则只需要很少的时空开销。

### 5.2、线程与进程的比较

1)调度。在传统的操作系统中,拥有资源和独立调度的基本单位都是进程。在引入线程的操作系统中,线程是独立调度的基本单位,进程是拥有资源的基本单位。在同一进程中,线程的切换不会引起进程切换,在不同进程中进行线程切换,如从一个进程内的线程切换到另一个进程中的线程时,会引起进程切换。

2)拥有资源。不论是传统操作系统还是设有线程的操作系统,进程都是拥有资源的基本位,而线程不拥有系统资源(也有一点儿必不可少的资源),但线程可以访问其隶属进程的系统资源。要知道,若线程也是拥有资源的单位,则切换线程就需要较大的时空开销,线程这个概念的提出就没有意义

3)并发性在引入线程的操作系统中不仅进程之间可以并发执行,而且多个线程之间也可以并发执行,从而使操作系统具有更好的并发性提高了系统的吞吐量

4)系统开销。由于创建或撤销进程时,系统都要为之分配或回收资源,如内存空间、I/O设备等,因此操作系统所付出的开销远大于创建或撤销线程时的开销,类似地,在进行进程切换时,涉及当前执行进程CPU环境的保存及新调度到进程CPU环境的设置,而线程切换时只需保存和设置少量寄存器内容,开销很小此外,由于同一进程内的多个线程共享进程的地址空间,因此这些线程之间的同步与通信非常容易实现,甚至无须操作系统的干预

5)地址空间和其他资源(如打开的文件)进程的地址空间之间互相独立,同一进程的各线程间共享进程的资源,某进程内的线程对于其他进程不可见

6)通信方面。进程间通信(IPC)需要进程同步和互斥手段的辅助,以保证数据的一致性,而线程间可以直接读写进程数据段(如全局变量)来进行通信

### 5.3、线程的属性

多线程操作系统把线程作为独立运行(或调度)的基本单位,此时的进程已不再是一个基本的可执行实体,但它仍具有与执行相关的状态。所谓进程处于“执行”状态,实际上是指该进程中的某线程正在执行,线程的主要属性如下：

- 1)线程是一个轻型实体,它不拥有系统资源,但每个线程都应有一个唯一的标识符和一个线程控制块,线程控制块记录了线程执行的寄存器和栈等现场状态
- 2)不同的线程可以执行相同的程序,即同一个服务程序被不同的用户调用时,操作系统把它们创建成不同的线程
- 3)同一进程中的各个线程共享该进程所拥有的资源。
- 4)线程是处理机的独立调度单位,多个线程是可以并发执行的。在单CPU的计算机系统中,各线程可交替地占用CPU;在多CPU的计算机系统中,各线程可同时占用不同的CPU若各个CPU同时为一个进程内的各线程服务则可缩短进程的处理时间
- 5)一个线程被创建后,便开始了它的生命周期直至终止线程在生命周期内会经历阻塞态、就绪态和运行态等各种状态变化

![os](http://images.zsjshao.net/ky/os/2/28.png)

为什么线程的提出有利于提高系统并发性?可以这样来理解:由于有了线程,线程切换时,有可能会发生进程切换,也有可能不发生进程切换,平均而言每次切换所需的开销就变小了,因此能够让更多的线程参与并发,而不会影响到响应时间等问题

### 5.4、线程的实现方式

线程的实现可以分为两类:用户级线程(User-Level Thread,ULT)和内核级线程(Kemel-Level-Thread,KLT).内核级线程又称内核支持的线程.

在用户级线程中,有关线程管理(线程的创建、撤消和切换等)的所有工作都由应用程序完成,内核意识不到线程的存在,应用程序可以通过使用线程库设计成多线程程序。通常,应用程序从单线程开始,在该线程中开始运行,在其运行的任何时刻,可以通过调用线程库中的派生例程创建一个在相同进程中运行的新线程,图(a)说明了用户级线程的实现方式

在内核级线程中,线程管理的所有工作由内核完成,应用程序没有进行线程管理的代码,只有一个到内核级线程的编程接口,内核为进程及其内部的每个线程维护上下文信息,调度也在内核基于线程架构的基础上完成图(b)说明了内核级线程的实现方式

有些系统中使用组合方式的多线程实现,线程创建完全在用户空间中完成,线程的调度和同步也在应用程序中进行。一个应用程序中的多个用户级线程被映射到一些(小于等于用户级线程的数目)内核级线程上。图(c)说明了用户级与内核级的组合实现方式

![os](http://images.zsjshao.net/ky/os/2/29.png)

### 5.5、多线程模型

有些系统同时支持用户线程和内核线程,由此产生了不同的多线程模型，即实现用户级线程和内核线程的连接方式

1)多对一模型,将多个用户级线程映射到一个内核级线程,线程管理在用户空间完成。此模式中,用户级线程对操作系统不可见(即透明)

- 优点;线程管理是在用户空间进行的,因而效率比较高
- 缺点:一个线程在使用内核服务时被阻塞,整个进程都会被阻塞:多个线程不能并行地运行在多处理机上

2)一对一模型。将每个用户级线程映射到一个内核级线程

- 优点:当一个线程被阻塞后,允许另一个线程继续执行,所以并发能力较强
- 缺点:每创建一个用户级线程都需要创建一个内核级线程与其对应,这样创建线程的开销比较大,会影响到应用程序的性能

3)多对多模型。将n个用户级线程映射到m个内核级线程上,要求m≤n

- 特点:多对多模型是多对一模型和一对模型的折中,既克服了多对一模型并发度不高的缺点,又克服了一对一模型的一个用户进程占用太多内核级线程而开销太大的缺点。此外,还拥有多对一模型和一对一模型各自的优点,可谓集两者之所长。

### 5.6、总结

![os](http://images.zsjshao.net/ky/os/2/30.png)

## 6、小结

1)为什么要引入进程?

在多道程序同时运行的背景下,进程之间需要共享系统资源,因此会导致各程序在执行过程中出现相互制约的关系,程序的执行会表现出间断性的特征,这些特征都是在程序的执行过程中发生的,是动态的过程,而传统的程序本身是一组指令的集合,是一个静态的概念,无法描述程序在内存中的执行情况,即我们无法从程序的字面上出它何时执行、何时停顿,也无法看出它与其他执行程序的关系,因此,程序这个静态概念已不能如实反映程序并发执行过程的特征。为了深刻描述程序动态执行过程的性质乃至更好地支持和管理多道程序的并发执行,人们引入了进程的概念

2)什么是进程?进程由什么组成?

进程是一个具有独立功能的程序关于某个数据集合的一次运行活动。它可以申请和拥有系统资源,是一个动态的概念,是一个活动的实体。它不只是程序的代码本身,还包括当前的活动通过程序计数器的值和处理寄存器的内容来表示

一个进程实体由程序段、相关数据段和PCB三部分构成,其中PCB是标志一个进程存在的唯一标识,程序段是进程运行的程序的代码,数据段则存储程序运行过程中相关的一些数据

3)进程是如何解决问题的?

进程把能够识别程序运行态的一些变量存放在PCB中,通过这些变量系统能够更好地了解进程的状况,并在适当时进行进程的切换以避免一些资源的浪费,甚至划分为更小的调度单位线程来提高系统的并发度。

本节主要介什么是进程,并围绕这个问题进行一些阐述和讨论,为下一节讨论的内容做铺垫,但之前未学过相关课程的读者可能会比较费解,到现在为止对进程这个概念还未形成比较清晰的认识接下来,我们再用一个比较熟悉的概念来类比进程,以大家能彻底理解本节的内容到底在讲什么,到底解决了什么问题

我们用“人的生命历程”来类比进程。首先,人的生命历程一定是一个动态的、过程性的概念,要研究人的生命历程,先要介绍经历这个历程的主体是什么,主体当然是人,相当于经历进程的主体是进程映像,人有自己的身份,相当于进程映像里有PCB;人生历程会经历好几种状态:出生的时候、弥留的时候、充满斗志的时候、发奋图强的时候及失落的时候,相当于进程有创建、撤销、就绪、运行、阻塞等状态,这几种状态会发生改变,人会充满斗志而转向发奋图强,发图强获得进步之后又会充满斗志预备下一次发奋图强,或者发奋图强后遇到阻碍会进入失落状态,然后在别人的开导之下又重新充满斗志类比进程,会由就绪态转向运行态,运行态转向就绪态,或者运行态转向阻塞态,然后在别的进程帮助下返回就绪态。

若我们用“人生历程”这个过程的概念去类比进程,则对进程的理解就会更深一层。前面生活化的例子可以帮我们理解进程的实质,但它毕竟有不严谨的地方。一种较好的方式是,在类比进程和“人生历程”后,再看一遍前面较为严谨的书面述和讨论,这样对知识的掌握会更加准确而全面.

这里再给出一些学习计算机科学知识的建议。学习科学知识时,很多同学会陷入一个误区,即只注重对定理、公式的应用,而忽视对基础概念的理解。这是我们从小到大为了应付考试而培养出的一个毛病,因为熟练应用公式和定理考试有立竿见影的效果。公式、定理的应用固然重要,但基础概念的理解能让我们透彻地理解一门学科,更利于我们产生兴趣,培养创造性思维。

本节的知识架构图如下:

![os](http://images.zsjshao.net/ky/os/2/31.png)

## 7、习题

### 7.1、单项选择题

**1.一个进程映像是()**

A.由协处理器执行的一个程序
B.一个独立的程序+数据集
C.PCB结构与程序和数据的组合
D.一个独立的程序

**2.下列关于线程的叙述中,正确的是()**

A.线程包含CPU现场,可以独立执行程序
B.每个线程有自己独立的地址空间
C.进程只能包含一个线程
D.线程之间的通信必须使用系统调用函数

**3.进程之间交换数据不能通过()途径进行**

A.共享文件
B.消息传递
C.访问进程地址空间
D.访问共享存储区

**4,进程与程序的根本区别是()**

A.静态和动态特点
B.是不是被调入内存
C.是不是具有就绪,运行和等待三种状态
D.是不是占有处理器

**5.下面的叙述中,正确的是()**

A.进程获得处理器运行是通过调度得到的
B.优先级是进程调度的重要依据,一旦确定不能改动
C.在单处理器系统中,任何时刻都只有一个进程处于运行态
D.进程申请处理器而得不到满足时,其状态变为阻塞态

**6.操作系统是根据()来对并发执行的进程进行控制和管理的**

A.进程的基本状态
B.进程控制块
C.多道程序设计
D.进程的优先权

**7.在任何时刻,一个进程的状态变化()引起另一个进程的状态变化**

A.必定
B.一定不
C.不一定
D.不可能

**8.在单处理器系统中,若同时存在10个进程,则处于就绪队列中的进程最多有()个**

A.1
B.8
C.9
D.10

**9.一个进程释放了一台打印机,它可能会改变()的状态**

A.自身进程
B.输入输出进程
C.另一个等待打印机的进程
D.所有等待打印机的进程

**10.系统进程所请求的一次I/O操作完成后将使进程状态从()**

A.运行态变为就绪态
B.运行态变为阻塞态
C.就绪态变为运行态
D.阻塞态变为就绪态

答案：CACAA BCCCD

**11.一个进程的基本状态可以从其他两种基本状态转变过去,这个基本的状态一定是()**

A.执行状态
B.阻塞态
C.就绪态
D.完成状态

**12.并发进程失去封闭性,是指()**

A.多个相对独立的进程以各自的速度向前推进
B.并发进程的执行结果与速度无关
C.并发进程执行时,在不同时刻发生的错误
D.并发进程共享变量,其执行结果与速度有关

**13.通常用户进程被建立后,()**

A.便一直存在于系统中,直到被操作人员撤销
B.随着进程运行的正常或不正常结束而撤销
C.随着时间片轮转而撤销与建立
D.随着进程的阻塞或者唤醒而销毁与建立

**14.进程在处理器上执行时,()**

A.进程之间是无关的,具有封闭特性
B.进程之间都有交互性,相互依赖、相互制约,具有并发性
C.具有并发性,即同时执行的特性
D.进程之间可能是无关的,但也可能是有交互性的

**15.下面的说法中,正确的是()**

A.不论是系统支持的线程还是用户级线程其切换都需要内核的支持
B.线程是资源分配的单位,进程是调度和分派的单位
C.不管系统中是否有线程,进程都是拥有资源的独立单位
D.在引入线程的系统中,进程仍是资源调度和分派的基本单位

**16.在多对一的线程模型中,当一个多线程进程中的某个线程被阻塞后，（）**

A.该进程的其他线程仍可继续运行
B.整个进程都将阻塞
C.该阻塞线程将被撤销
D.该阻塞线程将永远不可能再执行

**17.用信箱实现进程间互通信息的通信机制要有两个通信原语,它们是().**

A.发送原语和执行原语
B.就绪原语和执行原语
C.发送原语和接收原语
D.就绪原语和接收原语

**18.下列几种关于进程的叙述,()最不符合操作系统对进程的理解**

A.进程是在多程序环境中的完整程序
B.进程可以由程序,数据和PCB描述
C.线程(Thread)是一种特殊的进程
D.进程是程序在一个数据集合上的运行过程，它是系统进行资源分配和调度的一个独立单元

**19.支持多道程序设计的操作系统在运行过程中,不断地选择新进程运行来实现CPU的共享,但其中()不是引起操作系统选择新进程的直接原因**

A.运行进程的时间片用完
B.运行进程出错
C.运行进程要等待某一事件发生
D.有新进程进入就绪态

**20.若一个进程实体由PCB、共享正文段、数据堆段和数据栈段组成,请指出下列C语言程序中的内容及相关数据结构各位于哪一段中**

Ⅰ.全局赋值变量()
Ⅱ.未赋值的局部变量()
Ⅲ.函数调用实参传递值()
Ⅳ.用malloco求动态分配的存储区()
V.常量值(1995、string”)()
Ⅵ.进程的优先级()

A.PCB
B.正文段
C.堆段
D.栈段

答案：CDBDC BCAD BDDCBA

**21.同一程序经过多次创建,运行在不同的数据集上,形成了()的进程**

A.不同
B.相同
C.同步
D.互斥

**22.系统动态DLL库中的系统线程,被不同的进程所调用,它们是()的线程**

A.不同
B.相同
C.可能不同,也可能相同
D.不能被调用

**23.PCB是进程存在的唯一标志,下列()不属于PCB.**

A.进程ID
B.CPU状态
C.堆栈指针
D.全局变量

**24.一个计算机系统中,进程的最大数主要受到()限制**

A.内存大小
B.用户数目
C.打开的文件数
D.外部设备数量

25.进程创建完成后会进入一个序列,这个序列称为()
A.阻塞队列
B.桂起序列
C.就绪队列
D.运行队列
26.在一个多道系统中,若就队列不空,就绪的进程数越多,处理器的效率
A.越高
B.越低
C.不变
D.不确定
27.在具有通道设备的单处理器系统中实现并发技术后,()
A.各进程在某一时刻并行运行,CPU与1O设备间并行工作
B.各进程在某一时间段内并行行,CPU与1O设备间串行工作
C.各进程在某一时间段内并发运行,CPU与1O设备间并行工作
D.各进程在某一时刻并发运行,CPU与1设备间串行工作
28.进程自身决定()
A.从运行态到阻塞态
B.从运行态到就绪态
C.从就绪态到运行态
D.从阻塞态到就态
29.对进程的管理和控制使用()
A.指令
B.原语
C.信号量
D.信箱
30.【2010统考真题】下列选项中,导致创建新进程的操作是()
.用户登录成功
Ⅱ.设备分配
Ⅲ启动程序执行
A.仅1和Ⅱ
B.仅Ⅱ和
C.仅和
D.、Ⅱ、Ⅲ

答案：ABDAC CCABC

31.下面的叙述中,正确的是(
A.引入线程后,处理器只能在线程间切换
B.引入线程后,处理器仍在进程间切换
C.线程的切换,不会引起进程的切换
D.线程的切换,可能引起进程的切换
32.下面的叙述中,正确的是()
A.线程是比进程更小的能独立运行的基本单位,可以脱离进程独立运行
B.引入线程可提高程序并发执行的程度,可进一步提高系统效率
C.线程的引入增加了程序执行时的时空开铺
D.一个进程一定包含多个线程
33.下面的叙述中,正确的是()
回回
A.同一进程内的线程可并发执行,不同进程的线程只能串行执行
B.同一进程内的线程只能行执行,不同进程的线程可并发执行
C.同一进程或不同进程内的线程都只能串行执行
D.同一进程或不同进程内的线程都可以并发执行
34.【2014统考真题】在支持多线程的系统中,进程P创建的若千线程不能共享的是()

A.进程P的代码段
B.进程P中打开的文件
C.进程P的全局变量
D.进程P中某线程的栈针
35.在以下描述中,()并不是多线程系统的特长
A.利用线程并行地执行矩阵乘法运算
B.Web服务器利用线程响应HTTP请求
C.键盘驱动程序为每个正在运行的应用配备一个线程用以响应该应用的键盘输入
D.基于GUI的调试程序用不同的线程分别处理用户输入计算和跟除等操件
36.【2012统考真题】下列关于进程和线程的叙述中,正确的是(
A.不管系统是否支持线程,进程都是资源分配的基本单位
B.线程是资源分配的基本单位,进程是调度的基本单位
C.系统级线程和用户级线程的切换都需要内核的支持
D.同一进程中的各个线程拥有各自不同的地址空间
37.在进程转换时,下列()转换是不可能发生的。
回
A.就绪态→运行态
B.运行态→就绪态
C.运行态→阻塞态
D.阻塞态→运行态
38.当()时,进程从执行状态转变为就绪态
A.进程被调度程序选中
B.时间片到
C.等待某一事件
D.等待的事件发生
39.两个合作进程( Cooperating Processes无法利用()交换数据
A.文件系统
B.共享内存
C.高级语言程序设计中的全局变量D.消息传递系统

答案：DBDDC ADBCD

40.以下可能导致一个进程从运行态变为就绪态的事件是()
A.一次O操作结束
B.行进程需做O操作
C.运行进程结束
D.出现了比现在进程优先级更高的进程
41.()必会引起进程切换
A.一个进程创建后,进入就绪态
B.一个进程从运行态变为就绪态
C.一个进程从阻塞态变为就绪态
D.以上答案都不对
42.进程处于()时,它处于非塞态
A.等待从键盘输入数据
B.等待协作进程的一个信号
C.等待操作系统分配CPU时间
D.等待网络数据进入内存
43.【2010统考真题】下列选项中,降低进程优先级的合理时机是()
A.进程时间片用完
B.进程刚完成O操作,进入就绪队
C.进程长期处于就队列
D.进程从就转为行

44.一个进程被唤醒,意味着()
回
A.该进程可以重新竞争CPU
B.优先级变大
C.PCB移动到就绪队列之首
D.进程变为运行态
45.进程创建时,不需要做的是()
A.填写一个该进程的进程表项
B.分配该进程适当的内存
C.将该进程插入就队列
D.为该进程分配CPU
46.计算机两个系统中两个协作进程之间不能用来进行进程间通信的是(
A.数据库
B.共享内存
C.消息传递机制
D.管道
47.下列说法中,不正确的是()
A.一个进程可以创建一个或多个线程
B.一个线程可以创建一个或多个线程
C.一个线程可以创建一个或多个进程
D.一个进程可以创建一个或多个进程
48.【2014统考真题】一个进程的读磁盘操作完成后操作系统针对该进程必做的是()
A.修改进程状态为就绪态
B.降低进程优先级
C.给进程分配用户内存空间
CD.增加进程时间片大小
49.【2014统考真题】下列关于管道(Pipe通信的叙述中,正确的是()
A.一个管道可实现双向数据传输
B.管道的容量仅受磁盘容量大小限制
C.进程对管道进行读操作和写操作都可能被阻塞
D.一个管道只能有一个读进程或一个写进程对其操作
50.【2015统考真题】下列选项中,会导致进程从执行态变为就绪态的事件是()
A.执行P(wai)操作
B.申请内存失败
C.启动O设备
D.被高优先级进程枪占

答案：BCAAD ACACD

51.【2018统考真题】下列选项中,可能导致当前进程P租塞的事件是()
1.进程P申请临界资源
Ⅱ.进程P从磁盘读数据
Ⅲ系统将CPU分配给高优先的进程
A.仅1
B.仅Ⅱ
C.仅1
D.I.Ⅱ.Ⅲ
52.【2019统考真题】下列选项中,可能会将进程唤醒的事件是()
1.VO结束
1.某进程退出临界区.当前进程的时间片用完
A.仅1
B.仅Ⅲ
C.仅Ⅱ
D.I、ⅡⅢ
53.【2019统考真题】下列关于线程的描述中,错误的是()
A.内核级线程的调度由操作系统完成
B.操作系统为每个用户级线程建立一个线程控制块
C.用户级线程间的切换比内核级线程间的切换效率高
D.用户级线程可以在不支持内核级线程的操作系统上实现

答案：CCB

### 7.2、综合应用题

1.进程和程序之间可以形成一对一,一对多,多对一,多对多的关系请分别举例说明在什么情况下会形成这样的关系。

2.父进程创建子进程和主程序调用于程序有何不同?

3为什么进程之间的通信必须借助于操作系统内核功能主要方式

4.什么是多线程?多线程与多任务有什

5.回答下列问题:
1)若系统中没有运行进程,是否一定没有就绪进程?为什么?
2)若系统中既没有运行进程,又没有就绪进程,系统中是否就没有进程?为什么?
3)在采用优先级进程调度时运行进程是否一定是系统中优先级最高的进程?

6.现代操作系统一般都提供多进程(或称多任务运行环境,回答以下问题:
1)为支持多进程的并发执行,系统必须建立哪些关于进程的数据结构?
2)为支持进程状态的变迁,系统至少应提供哪些进程控制原语?
3)执行每个进程控制原语时,进程状态发生什么变化?相应的数据结构发生什么变化?

7.某分时系统中的进程可能出现如下图所示的状态变化,请回答下列问题:
1)图示,统用什么进程调度策?

2)把图中每个状态变化的可能原因填写在下表中



52   58