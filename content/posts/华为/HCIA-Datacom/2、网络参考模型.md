## 应用和数据

### 故事的起源 - 应用

应用的存在，是为了满足人们的各种需求，比如访问网页，在线游戏，在线视频等。

伴随着应用会有信息的产生。比如文本，图片，视频等都是信息的不同呈现方式。

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/osi01.png)

### 应用的实现 - 数据

• 数据的产生

​    ▫ 在计算机领域，数据是各种信息的载体。

• 数据传输

​    ▫ 大部分应用程序所产生的数据需要在不同的设备之间传递。

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/osi02.png)

• 计算机只能识别0和1的组成的电子数据(digital data)。它不具备读取各种信息的能力，所以信息需要通过一定的规则翻译成数据。

• 而对人来说，我们不具备读取电子数据的能力，所以在读取信息的时候，需要将数据转成人能理解的信息。

• 对于一名网络工程师来说，需要更关注数据的端到端传递的过程。

## 网络参考模型与标准协议

### OSI参考模型
|7. 应用层 |对应用程序提供接口。|
|-|-|
|6. 表示层 |进行数据格式的转换，以确保一个系统生成的应用层数据能够被另外一个系统的应用层所识别和理解。|
|5. 会话层 |在通信双方之间建立、管理和终止会话。|
|4. 传输层 |建立、维护和取消一次端到端的数据传输过程。控制传输节奏的快慢，调整数据的排序等等。|
|3. 网络层 |定义逻辑地址；实现数据从源到目的地的转发。|
|2. 数据链路层 |将分组数据封装成帧；在数据链路上实现数据的点到点、或点到多点方式的直接通|信；差错检测。
|1. 物理层 |在媒介上传输比特流；提供机械的和电气的规约。|

### TCP/IP参考模型

因为OSI协议栈比较复杂，且TCP和IP两大协议在业界被广泛使用，所以TCP/IP参考模型成为了互联网的主流参考模型。

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/osi03.png)

• TCP/IP模型在结构上与OSI模型类似，采用分层架构，同时层与层之间联系紧密。

• TCP/IP标准参考模型将OSI中的数据链路层和物理层合并为网络接入层，这种划分方式其实是有悖于现实协议制定情况的，故融合了TCP/IP标准模型和OSI模型的TCP/IP对等模型被提出，后面的讲解也都将基于这种模型。

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/tcpip.png)

### 常见协议标准化组织

• IETF(Internet Engineering Task Force)

​    ▫ 负责开发和推广互联网协议（特别是构成TCP/IP协议族的协议）的志愿组织，通过RFC发布新的或者取代老的协议标准。

• IEEE(Institute of Electrical and Electronics Engineers)

​    ▫ IEEE制定了全世界电子、电气和计算机科学领域30%左右的标准，比较知名的有IEEE802.3(Ethernet)、IEEE802.11(Wi-Fi)等。

• ISO(International Organization for Standardization)

​    ▫ 在制定计算机网络标准方面，ISO是起着重大作用的国际组织，如OSI模型，定义于ISO/IEC 7498-1。


## 数据通信过程

### 发送方数据封装

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/osi04.png)

### 中间网络数据传输

封装好的完整数据，将会在网络中被传递。

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/osi05.png)

▫ 网络中的二层设备（如以太网交换机）只会解封装数据的二层头部，根据二层头部的信息进行相应的“交换”操作。

▫ 网络中的三层设备（如路由器）只会解封装到三层头部，并且根据三层头部的信息进行相应的“路由”操作。

### 接收方数据解封装

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/osi06.png)

## TCP/IP协议栈

### TCP/IP协议栈简介

TCP/IP分层：网络接入层、网络层、传输层、应用层

与OSI模型的区别

- TCP/IP总共定义了4层
- OSI的1、2层合并为网络接入层
- OSI的5、6、7层合并为网络应用层
- OSI模型与TCP/IP模型都是描述网络设备之间通讯标准流程
- TCP/IP模型是Internet的基本协议

![10_tcpip](http://images.zsjshao.cn/images/rs/01-osi/10_tcpip.png)

### TCP/IP协议栈

![11_tcpip](http://images.zsjshao.cn/images/rs/01-osi/11_tcpip.png)

TCP/IP每一层都让数据得以通过网络进行传输，这些层之间使用PDU（Packet Data Unit，协议数据单元）彼此交换信息，确保网络设备之间能够通信。

不同层的PDU中包含有不同的信息，因此PDU在不同层被赋予了不同的名称。

- 应用层的PDU被称为Data（数据）。
- 传输层的PDU被称为Segment（段）。
- 网络层的PDU被称为Packet（包）。
- 数据链路层的PDU被称为Frame（帧）.
- 物理层的PDU被称为比特流（Bitstream）。

#### 应用层

```
为应用程序提供网络服务
  网络应用
    微博、微信、QQ、迅雷……
  
  邮件服务（SMTP、POP3）
    Outlook、新浪邮箱……
  
  网页服务（http、https）
    百度、搜狐、网易
  
  网络管理
    SNMP
  
  远程登录
    Telnet、ssh
  
  地址服务
    DNS、DHCP
```

#### 传输层

```
提供端到端的传输服务
  基于TCP的协议，可靠传输、有重传机制
    FTP、SMTP、Telnet、HTTP

  基于UDP的协议，不可靠传输、效率高
    TFTP、SNMP、DHCP
```

TCP/UDP端口号范围是0\~65535，其中0~1023是熟知端口号，已固定分配给常用应用程序

用于在主机系统中区分不同的应用程序，数据传输最终是程序之间的互相访问

- 例1：主机A远程登录主机B，随机端口1028作为源端口，主机B的23端口作为目的端口

- 例2：主机A通过浏览器发起HTTP访问，随机端口作为源端口，主机C的80端口作为目的端口

![12_transport](http://images.zsjshao.cn/images/rs/01-osi/12_transport.png)

##### TCP/UDP 常见协议端口号

![13_port](http://images.zsjshao.cn/images/rs/01-osi/13_port.png)

##### 传输层的区别

UDP报文结构简单，传输效率高，但不具备排序功能以及重传机制，数据包到达目的地时，有可能因为网络问题，出现乱序或者丢包现象

- 常用在视频、语音应用等

![14_udp](http://images.zsjshao.cn/images/rs/01-osi/14_udp.png)

TCP报文结构相对复杂，具备序列号、确认号、窗口大小等字段，使其具备排序功能、重传机制、滑动窗口机制，确保数据传输的可靠性，使得数据能够准确按序到达目的地

- 常用在HTTP、FTP等可靠传输

![15_tcp](http://images.zsjshao.cn/images/rs/01-osi/15_tcp.png)

基于TCP协议

- 传输数据前：由TCP建立连接
- 传输过程中：由TCP解决可靠性、有序性，进行流量控制
- 传输结束后：由TCP拆除连接

TCP头部字段

- 端口号：源端口标识发送方的进程，目的端口标识接收方的进程
- 序列号：保证数据传输的有序性，确认号对收到的数据进行确认
- 窗口大小：传输阶段，每次连续发送数据的大小
- Flag字段：
  - ACK：确认号标志，置1表示确认号有效，表示收到对端的特定数据
  - RST：复位标志，置1表示拒绝错误和非法的数据包，复位错误的连接
  - SYN：同步序号标志，置1表示同步序号，用来建立连接
  - FIN：结束标志，置1表示连接将被断开，用于拆除连接

![16_tcp3](http://images.zsjshao.cn/images/rs/01-osi/16_tcp3.png)

###### TCP协议工作过程 —— 建立连接 

数据传输之前：三次握手建立连接

Tcp是面向连接的，TCP在传输数据之前必须先建立连接

为建立连接，两台主机的初始序列号ISN必须同步,同步是通过交换三个TCP报文完成的，和正常的tcp报文不同的是，这个TCP报文flag位中的syn置位为1，表示要和对方协商同步ISN，我们把这个过程叫做三次握手建立连接

![17_tcp3](http://images.zsjshao.cn/images/rs/01-osi/17_tcp3.png)

如图所示

1、PC1发送到第一个tcp报文syn置位为1，序列号是由pc1随机厂商的，序列号为A

2、PC2收到pc1发送到报文后，在回应的报文中把ack置位，确认号置位为a+1，表示知晓了pc1的初始序列号，同时把syn置位，把自己的随机序列号b告诉pc1

3、PC1收到报文，在回应的报文中也通过ack的置位和确认号表示知晓了pc2的初始序列号

通过双方交换的这三个报文，完成tcp初始序列号的同步，预留了资源，建立了连接，就可以开始传输数据

建立连接后，所有数据的ack位都会置位

###### TCP协议工作过程 —— 数据传输

数据传输过程中，发送方发送窗口大小的数据，接收方只进行一次确认

如果接收方处理能力不足，会调整窗口大小，接收方按新的窗口进行数据发送

![18_window](http://images.zsjshao.cn/images/rs/01-osi/18_window.png)

###### TCP协议工作过程 —— 重传机制

当某个包因网络问题，传输失败，接收方仅确认上一个数据包

发送方将根据确认号，进行数据重传

![19_resent](http://images.zsjshao.cn/images/rs/01-osi/19_resent.png)

###### TCP协议工作过程 —— 拆除连接

四次挥手拆除连接， TCP通过FIN置位为1表示拆除连接

![20_tcp4](http://images.zsjshao.cn/images/rs/01-osi/20_tcp4.png)

#### 网络层

```
提供主机到主机的传输服务

IP
  提供主机到主机的传输服务

ICMP 
  辅助IP工作，提供出错和控制信息

ARP 
  解析IP与MAC的映射
```

网络层提供主机到主机的传输服务，这种服务是由IP协议提供的,ICMP辅助IP工作，提供出错和控制信息，而ARP协议在以太网中提供IP地址和MAC地址之间的映射。

#### 网络接入层

```
在相邻节点间提供数据传输服务

局域网
  IEEE802.2   定义LLC子层
  IEEE802.3   以太网标准

广域网
  HDLC
  PPP
  Frame Relay

为数据传输提供物理通道

定义接口、线缆标准、传输速率、传输距离等参数

物理层介质
  同轴电缆、双绞线、光纤、无线等
```

每层协议报文都有特定的名称，传输层一般叫做UDP报文或者TCP段，网络层叫做IP包，而数据链路层的协议包一般叫做帧。

数据链路层通过介质在相邻节点间提供数据传输服务

由于存在种类繁多的物理介质，因此在数据链路层定义了不同的数据链路层协议，定义了帧的类型及介质访问方式

在局域网中，IEEE组织通过802.2和802.3定义了一系列协议，而网络中，则定义了HDLC，PPP、帧中继等协议





思考题

1. 分层模型的概念有什么好处？

   ▫ 各个层次之间分工、界限明确，有助于各个部件的开发、设计和故障排除。

   ▫ 通过定义在模型的每一层实现什么功能,鼓励产业的标准化。

   ▫ 通过提供接口的方式，使得各种类型的网络硬件和软件能够相互通信，提高兼容性。

2. 常见的应用层、传输层、网络层、数据链路层有哪些协议？

   ▫ 应用层：HTTP、FTP、Telnet等

   ▫ 传输层：UDP、TCP

   ▫ 网络层：IP、ICMP等

   ▫ 数据链路层：Ethernet、PPP、PPPoE等



## 以太网和MAC地址

![osi](http://images.zsjshao.cn/images/huawei/HCIA-Datacom/02-OSI/osi07.png)

MAC地址由48比特（6个字节）长，12位的16进制数字组成。例如：48-A4-72-1C-8F-4F

### MAC地址概念

单播MAC

- 单播：点对点，第8位为0

组播MAC

- 组播：逻辑MAC，第8位为1

广播MAC

- 广播：全为1

ARP
