## TCP/IP

### 数据链路层

网络通信协议：

- 局域网（以太网）：IEEE 802.3、Ethernet_II

- 广域网：PPP、HDLC



Ethernet_II ：D.MAC:S.MAC:Type:Date:FCS

IEEE 802.3：D.MAC:S.MAC:Length:LLC:SNAP:Date:FCS

- Length/Type>=1536(0x0600)      Ethernet_II

  Length/Type<=1500(0x05DC)     IEEE 802.3

- LLC：D.SAP:S.SAP:Control

  - D.SAP：目标服务接入点
  - S.SAP：源服务接入点
  - Control：未使用，0x03

- SNAP：Org Code:Type  子网络服务接入点（私有化）

  - Org Code：机构标识
  - Type：协议标识



### 网络层

MAC地址

- 24bit+24bit

```
十六进制：0A-00-27-00-00-05
二进制：1010 00000000 00100111 00000000 00000000 00000101
```

单播：源目都是单播MAC

- 单播MAC：从高位向低位（从左往右）第8位为0，且一定为0，其他任意

组播：点对多点

- 组播MAC：从高位向低位（从左往右）第8位为1，且一定为1，其他任意

广播：

- 全1，FF:FF:FF:FF:FF:FF



IP报文头部

- 大小：20-60B

![02_ipv4](http://images.zsjshao.cn/images/rs/27-router/02_ipv4.png)

IP地址分类：

- A类：0开头，0-127

- B类：10开头，128-191

- C类：110开头，192-223

- D类：1110开头，224-239

- E类：1111开头，240-255

特殊地址：

- 0.0.0.0   //不可用    0.0.0.0  -  0.255.255.255

  - 作用：1、未指定的地址

    ​            2、路由层面：全网所有地址

- 127.0.0.0  //环回地址  127.0.0.0  -  127.255.255.255
  - 用于设备内部的TCP/IP协议栈使用



私网地址：

- 10.0.0.0 ~ 10.255.255.255
- 172.16.0.0 ~ 172.31.255.255
- 192.168.0.0 ~ 192.168.255.255



子网掩码

- 网段范围 -- 掩码

定义两个参数：1、网络位   2、主机位

IP + 掩码 == 网段



VLSM：子网划分

CIDR：无类域间路由 / 超网



网关：转发不同网段的数据包



ICMP：Internet Control Message Protocol

- 用来传递差错、控制、查询等信息
- Type:Code:CheckSum

| 类型 | 编码 | 描述                       |
| ---- | ---- | -------------------------- |
| 0    | 0    | Echo Reply                 |
| 3    | 0    | 网络不可达                 |
| 3    | 1    | 主机不可达                 |
| 3    | 2    | 协议不可达                 |
| 3    | 3    | 端口不可达                 |
| 5    | 0    | 重定向（多出口，次优路径） |
| 8    | 0    | Echo Request               |
| 11   | 0    | TTL超时                    |



ARP：



### 传输层

TCP：传输控制协议  --  面向连接的协议

- 大小：20-60
- 三次握手，四次挥手



UDP：用户数据包协议 -- 面向无连接的协议

- 大小：6-8
- 尽力而为的传输



端口

- 0-1023端口：知名端口，提前保留出来的端口

- ftp：20-21，ssh：22，telnet：23，dns：53，dhcp：67-68，tftp：69，http：80，https：443

- 大于1024：随机端口





## 路由

### 路由的分类

网段路由：网络号+掩码

主机路由：/32，标识具体的一台主机



### 路由表的形成：

直连路由：direct  根据设备的接口形成的

静态路由：管理员手动添加

动态路由：动态路由协议生成



路由加表：最优加表

- 比较优先级 pre
- 比较度量值 cost

数据转发：最长掩码匹配原则



静态路由：

```
[huawei]ip route-static IP_ADDR INTEGER IP_ADDR INTERFACE
```

动态路由协议：

- IGP：内部网关协议，RIP、OSPF、IS-IS
- EGP：外部网关协议，BGP



### OSPF

OSPF：开放式最短路径优先，链路状态

```
# 进程下宣告
[huawei]ospf 1
[huawei]area 0
[huawei-ospf-1-area-0.0.0.0]network 12.1.1.0 0.0.0.255

# 接口下宣告
[huawei]int gi0/0/0
[huawei-GigabitEthernet0/0/0]ospf enable 1 area 0

# 查看邻居
[huawei]display ospf peer [brief]
```



## 交换

### vlan

```
# access
[huawei]vlan 10
[huawei] int gi0/0/1
[huawei-GigabitEthernet0/0/1]port link-type access             # access、dot1q-tunnel、hybrid、trunk
[huawei-GigabitEthernet0/0/1]port default vlan 10

# trunk
[huawei]vlan batch 10 20
[huawei] int gi0/0/3
[huawei-GigabitEthernet0/0/3]port link-type trunk
[huawei-GigabitEthernet0/0/3]port trunk allow-pass vlan 10 20

# hybrid vlan10和vlan20与vlan100跨交换机进行通信
[huawei]vlan batch 10 20 100
[huawei]int gi0/0/1
[huawei-GigabitEthernet0/0/1]port link-type hybrid
[huawei-GigabitEthernet0/0/1]port hybrid pvid vlan 10
[huawei-GigabitEthernet0/0/1]port hybrid untagged vlan 10 100
[huawei]int gi0/0/2
[huawei-GigabitEthernet0/0/2]port link-type hybrid
[huawei-GigabitEthernet0/0/2]port hybrid pvid vlan 20
[huawei-GigabitEthernet0/0/2]port hybrid untagged vlan 20 100
[huawei]int gi0/0/3
[huawei-GigabitEthernet0/0/3]port link-type hybrid
[huawei-GigabitEthernet0/0/3]port hybrid tagged vlan 10 20 100
```

### vlan间路由

单臂路由：略

- 注意：子接口需要开启ARP广播功能，接口下执行：arp broadcast enable

vlan间路由

```
[huawei]vlan batch 10 20
[huawei]int vlan 10
[huawei]ip addr 192.168.10.254 24
```

### 生成树

报文格式

PID:PVI:BPDU Type:Flags:Root ID:RPC:Bridge ID:Port ID:Message Age:Max Age:Hello Time:Fwd Delay

```
```

### 链路聚合

```
[huawei]interface Eth-Trunk 1
[huawei-Eth-Trunk1]mode manual load-balance     #默认模式，manual、lacp-static
[huawei-Eth-Trunk1]trunkport GigabitEthernet 0/0/1 to 0/0/2
[huawei]display eth-trunk 1
```























